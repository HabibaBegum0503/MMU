function setDependencyData(n,t){dependencies=n;dependencyGroups=t}function DependencyObject(n,t,i,r,u){this.targetPanelId=n;this.conditionTrueValues=JSON.parse(t);this.dependencyActionId=i;this.dependencyType=r;this.andGroupId=u;this.handled=!1}function PanelObject(n,t){this.sourcePanelId=n;this.dependencyArray=t}function ElementInstanceObject(n,t,i,r){this.CloneElementId=n;this.CloneElementInstanceId=t;this.ElementId=i;this.ElementInstanceId=r}function validateForm(){}function removePanel(n){var u;setDataHasChanged(!0);var f=n,t=$(f).closest(".panel"),i=$(t).closest(".repeater-panel-container"),r=$(i).find(".panel").first(),e=$(r).find(".text-title-field-container");r.attr("data-instance")==t.attr("data-instance")&&r.find(".row").length==1&&r.next("div").find(".rows-container .row").prepend(e);$(f).hasClass("remove-repeated-signature")&&(u=$(n).parent().find(".row .signature-container").parent(),$.ajax({url:"/Signature/RemoveSignatureRequest",data:{userProjectFormId:$("#UserProjectFormId").val(),questionid:u.attr("data-id"),instance:u.attr("data-instance")},error:function(){showFeedback("failure","Signature was not removed")}}));$(t).fadeOut(250,function(){var r,n;$("select[data-dependentondynamic]").length>0&&(r=$(t).find(".row :input"),$("select[data-dependentondynamic]").each(function(n,i){var r=JSON.parse($(i).attr("data-dependentondynamic"));$(r).each(function(n,r){var f=$(t).find('.row[data-id="'+r+'"] :input'),u;$(f).length>0&&(u=$(t).attr("data-instance"),$("#"+$(i)[0].id+" option[value = '"+u+"']").remove())});$(i).trigger("chosen:updated")}));$(t).remove();n=$(i).find(".panel:last-child");$(n).children(".add-new").show();$(i).find(".panel").length==1&&$(i).find(".btn-danger").hide()})}function getID(n,t,i){var u=n.Id,f=t.Id,r=i.Id;return r+"_1"}function getMaxLength(n){var i=65535,t=0;try{t=parseInt(n,10)}catch(r){return i}return isNaN(t)||t<=0||t>=i?i:t}function htmlEncode(n){return n?jQuery("<div />").text(n).html():""}function htmlDecode(n){return n?$("<div />").html(n).text():""}function getInstances(n){var t=1;$(".document-table-container .table  tbody").empty();$.each(n,function(n,i){var u=i.Enabled,f=i.PanelId,o=i.Instance,e=i.Elements,s=i.Mandatory,r=$(".panel[data-id="+f+"]");i.LockedByApplicant||i.LockedByReviewer||i.HasRelatedUser?(r.find(":input").attr("disabled","disabled"),i.HasRelatedUser&&r.find(":input").addClass("disable-default"),r.find(".btn.add-new, .btn.remove-new, a.page-contact .btn-danger").attr("disabled","disabled").removeAttr("onclick").unbind()):i.IsShared&&i.IsPanelSubFormShared?i.IsContact&&i.Searchable&&i.IsSharedEditable?(r.find(":input").attr("disabled","disabled").addClass("disable-default"),r.find(":input.searchUser").removeAttr("disabled")):i.IsSharedEditable||(r.find(":input").attr("disabled","disabled").addClass("disable-default"),r.find(".btn.add-new, .btn.remove-new, a.page-contact").attr("disabled","disabled").removeAttr("onclick").unbind()):i.IsContact&&i.Searchable&&(r.find(":input").attr("disabled","disabled").addClass("disable-default"),r.find(":input.searchUser").removeAttr("disabled"));Array.isArray(i.Value)&&r.attr("data-value",i.Value);u==null&&(u=!0);$.each(e,function(n,i){var r=i.ElementId,e=i.Value,c=r.indexOf("_"),l=r.substring(0,c),s=r.lastIndexOf("_"),u=r.substring(s+1),o=r.substring(0,s),f,h;u==1?t=1:u>t?(i.ElementTypeId=="131072"&&(f=new ElementInstanceObject,f=findPreviousInstance(r,o,u),r=f.ElementId,u=f.ElementInstanceId),createNewInstance(r,o,e,u-1)):u>1&&(h=$("#"+r),h.length==0&&createNewInstance(r,o,e,u-1));t=u;assignUserAnswersToElements(r,e)});u==!1?($(r).hide(),$(r).attr("data-enabled","false")):($(r).show(),$(r).attr("data-enabled","true"))});displaySignatures();$(".panel-group .container").each(function(n,t){var i=$(t);i.find(".panel:visible").length==0&&i.parent().hide()});$(".document-table-container").each(function(n,t){var i=$(t);i.find("table tbody tr").length==0&&(i.find("table").hide(),i.css("overflow-x","hidden"))});checkLocked();$(".signature-repeater .panel:last .add-new-signature").show()}function assignUserAnswersToElements(n,t){var i=$("#"+n),h=$(i).prop("tagName"),f=$(i).attr("type"),s;if(f=="radio")t=="True"&&$(i).prop("checked",!0);else if(f=="checkbox")t=="True"&&$(i).prop("checked",!0);else if(f=="image"){$("#"+n).val(t);var e=$(i).siblings("div.document-table-container").find("table"),r=$(i).siblings("div.document-table-container").find("table thead"),u=$(i).siblings("div.document-table-container").find("table tbody"),o=$("#UserProjectFormId").val();r.empty();$(r).append("<th scope='col'>"+Type+"<\/th>");s=occurrences(t,"<\/td>");$(r).append("<th scope='col'>"+Document_Name+"<\/th>");$(r).append("<th scope='col'>"+Filename+"<\/th>");$(r).append("<th scope='col'>"+Version_Date+"<\/th>");$(r).append("<th scope='col'>"+Version+"<\/th>");$(r).append("<th scope='col'>"+Size+"<\/th>");$(r).append("<th scope='col'>"+View+"<\/th>");$(r).append("<th scope='col'>"+Delete+"<\/th>");t.length!=0&&t!="[]"&&($(e).hide(),$.get("/Page/GetDocumentTable?userProjectId="+$("#UserProjectId").val()+"&userProjectFormId="+o+"&userpanelId"+$(i).closest(".row").attr("data-userpanelid")+"&elementId"+n+"&instance"+$(i).closest(".panel").attr("instance"),function(n){$(u).html(n);n.length!=0&&($(e).show(),enableOrDisableUploadDocument($(u.parents(".panel"))))}).fail(function(){showFeedback("failure","Document table error");enableOrDisableUploadDocument($(u.parents(".panel")))}));$(u).find("tr").show()}else $(i).hasClass("datepicker")?$(i).datepicker("setDate",t):($("#"+n).val(t),$(i).hasClass("numericInput")&&$(i).numericInput({allowFloat:!0,allowNegative:!0}),$(i).hasClass("decimalInput")&&$(i).numericInput({allowFloat:!0,allowNegative:!1}))}function calculateAndAssignPanelValues(){var n=$(".panel");$.each(n,function(){var n=0,t=$(this).find("[type=radio],[type=checkbox],select");$.each(t,function(){var t=0,i=this;i.type=="select-one"?(t=$(this).val(),n=n+parseInt(t)):$(this).prop("checked")==!0&&(t=$(this).attr("data-bitvalue"),n=n+parseInt(t))});$(this).attr("data-value",n)})}function calculateAndAssignPanelValue(n){var r=$($(n).parents(".panel")[0]),i=$($(n).parents(".row")[0]),t=[],u=i.find("[type=radio],[type=checkbox],select");$.each(u,function(){var n=0,i=this;i.type=="select-one"?(n=$(this).val(),n!="0"&&t.push(parseInt(n))):$(this).prop("checked")==!0&&(n=$(this).attr("data-bitvalue"),t.push(parseInt(n)))});r.attr("data-value",JSON.stringify(t));i.attr("data-value",JSON.stringify(t))}function createNewInstance(n,t,i,r){var o=r,s=t+"_"+o,u=$("#"+s),f=u.parents(".panel"),e;f.removeClass("moveup");e=f.children(".add-new");u.hasClass("signature-input")||u.hasClass("signature-request-input")||f.find(":input").hasClass("signature-input")||f.find(":input").hasClass("signature-request-input")?addAnother(e,!0,!0,!1,u):addAnother(e,!0,!1,!1,u)}function findPreviousInstance(n,t,i){var r=i-1,f=t+"_"+r,o=$("#"+f),e=new ElementInstanceObject(f,r,t+"_"+i,i),u=r+1;return o.length<1&&(e=findPreviousInstance(n,t,r),u=e.ElementInstanceId),new ElementInstanceObject(t+"_"+r,r,t+"_"+u,u)}function addAnother(n,t,i,r,u){var a=n,c=$(a).siblings(".remove-new"),e=u!=null?$(u).parents(".panel").first():$(n).parents(".panel").first(),o,f,y;c.show();var s=parseInt($(e).attr("data-instance")),v=e.closest(".repeater-panel-container"),l=v.find(".panel"),h=1;l.each(function(n,t){parseInt($(t).attr("data-instance"))>parseInt(h)&&(h=parseInt($(t).attr("data-instance")))});o=h+1;f=$(e).clone();f.removeClass("moveup");t==!1&&setDataHasChanged(!0);$(f).children(".rows-container").css("background","#fff");$(f).find(".label-element").remove();$(f).find(".icon-info16").remove();$(f).find(".document-table-container tbody").html("");$(f).find(".document-table-container table").css("display","none");$(f).find(".btn-forms-document").css("display","inline-block");$(f).find(":input:not(.k-input, button)").each(function(){var t;if($(this).parent().hasClass("search-field"))return $(this).closest(".chosen-container-multi").remove(),!0;if(t=$(this).attr("id"),resetElementIdInstance(this,o),$(this).attr("type")=="radio"||$(this).attr("type")=="checkbox"){if($(this).attr("type")=="radio"){var n=$(this).attr("name"),i=n.indexOf("_"),r=n.substring(0,i)+"_"+o;$(this).attr("name",r)}$(this).attr("type")=="radio"?$(this).closest("tr").find("label").attr("for",$(this).attr("id")):$(this).closest("div").find("label").attr("for",$(this).attr("id"))}$(this).hasClass("numericInput")&&$(this).numericInput({allowFloat:!0,allowNegative:!0});$(this).hasClass("decimalInput")&&$(this).numericInput({allowFloat:!0,allowNegative:!1});$(this).attr("data-elementtypeid")==2&&$(this).css("height","")});$(f).find(":input(.contactShareBtn, contactShareRoleBtn)").each(function(){$(this).attr("data-instance",o)});r?($(f).find(".dynamic-field-container select").each(function(){var n=$(this),t=n.attr("id").substring(0,n.attr("id").indexOf("_")),i=t+"_"+s;n.val($("#"+i).val()).chosen().trigger("chosen:updated")}),$(f).find(".select-container select").each(function(){var n=$(this),t=n.attr("id").substring(0,n.attr("id").indexOf("_")),i=t+"_"+s;n.val($("#"+i).val())})):$(f).find(".dynamic-field-container select").val("").chosen().trigger("chosen:updated");l.length==1&&$(c).hide();$(e).after(f);$(f).css("display","none");t?$(f).show():$(f).fadeIn();$(f).attr("data-instance",o);$(f).find(".row").attr("data-instance",o);$(f).css("margin-bottom","40px");$(e).css("margin-bottom","40px");$(f).find(".row").length==1&&$(f).find(".text-title-field-container").remove();s==1&&($(f).find(".btn-danger").show(),$(e).find(".btn-danger").show());clearPanelAnswers(f,!1,r);$(f).find("input:checkbox, input:radio, select").each(function(){inputClick($(this))});i==!0&&(setDataHasChanged(!0),f.find(".remove-new").addClass("remove-repeated-signature"),f.find(".request-button").removeAttr("disabled").attr("onclick","requestSignatureOverlay(this, true)"),f.find(".sign-button").removeAttr("disabled").attr("onclick","signFormOverlay(this)"),resetElementIdInstance($(f).find(".request-button"),o),resetElementIdInstance($(f).find(".sign-button"),o),(e.find(".signature-input").val()>0||e.find(".signature-request-input").val()>0)&&e.find(".remove-new").hide(),$(f).find(".alert").hide());getDynamicLists();setSearchInputs();$(":input",f).change(function(){setDataHasChanged(!0)});i==!1;f.find(":input[data-linkedquestion]").length>0&&(y=f.find(":input[data-linkedquestion]").attr("data-linkedquestion"),$("select[data-dependentondynamic]").each(function(n,t){var i=JSON.parse($(t).attr("data-dependentondynamic"));f.find('.row[data-id="'+i[0]+'"]').length>0&&($(t).append(new Option("",o)),$(t).trigger("chosen:updated"))}));reInitialize();f.find(".row").each(function(){var n=$(this);n.attr("data-isdocument").toLowerCase()=="true"&&preSaveFormCheck()})}function viewAsTable(n){if(!$(".btn-viewastable").hasClass("disabled")){var t=$(n).closest(".panel");loadRepeatablePanelAsTable(t)}}function viewAsForm(n){$('.viewastable[data-panelastableid="'+n+'"]').remove();$('.panel[data-id="'+n+'"]').show();$(".btn-viewastable").removeClass("disabled")}function loadRepeatablePanelAsTable(n){var t=$(n).attr("data-id"),i=$("#UserProjectFormId").val();$.ajax({type:"GET",url:"/Page/GetPanelAsTable/",data:{panelId:t,userProjectId:parseInt($("#UserProjectId").val()),userProjectFormId:i,version:parseInt($("#Version").val())},success:function(i){var r=$(n);r.after(i);$('.panel[data-id="'+t+'"]').hide();return},error:function(){showFeedback("failure","Error getting question data.");showHideViewAsTableButton()}})}function clearPanelAnswers(n,t,i){if(i){$(n).find("input.document-hiddenInput, [data-contact]").each(function(){$(this).val("")});return}t?$(n).find("input:checkbox, input:radio, select").each(function(){$(this).val("");$(this).prop("checked",!1)}):$(n).find(":input").each(function(){$(this).val("");$(this).prop("checked",!1)});$(n).attr("data-value","[]")}function updateDynamicQuestion(n){var t=$(n).attr("data-linkedquestion");$('.panel[data-id="'+t+'"]').each(function(){var t,i;parentPanel=$(n).closest(".panel");t=parentPanel.attr("data-instance");$("select[data-dependentondynamic]").length>0&&(i=$(parentPanel).find(".row :input"),$("select[data-dependentondynamic]").each(function(n,i){var r=[],f=JSON.parse($(i).attr("data-dependentondynamic")),u;$(f).each(function(n,t){var i=$(parentPanel).find('.row[data-id="'+t+'"] :input');if(!i.is(":visible"))return!0;i[0].type=="radio"&&$(i).each(function(){$(this).is(":checked")&&r.push($(this).closest("tr").find("label").text())});i[0].type=="text"&&$(i).val().length>0&&r.push($(i).val());i[0].type=="select-one"&&$(i).val()!="0"&&r.push(i[0].options[i[0].selectedIndex].text)});r.length>0&&(u=r.join(" - "),$(i).find('option[value="'+t+'"]').length==0&&$(i).append(new Option(u,t)),$(i).find('option[value="'+t+'"]').text(u).prop("selected",!1),$(i).trigger("chosen:updated"))}))})}function getPanelSaveDataAsJson(n){var i=$("#page-form .panel .row"),t;return n&&(i=n),t=[],$.each(i,function(){var u=$(this).find(":input"),i=this,f=$(i).attr("data-id"),e=$(i).closest(".panel").attr("data-id"),o=$(i).attr("data-value"),r=$(i).attr("data-enabled"),s=$(i).attr("data-mandatory").toLowerCase()=="true",h=$(i).attr("data-instance"),n;r==null&&(r=!0);n=[];n.slice(0);t.push({id:f,panelid:e,value:o,enabled:r,mandatory:s,instance:h,elements:n});$.each(u,function(){var t=this,f=t.id,i,r,u;if($(t).parent().hasClass("search-field"))return!0;i=$(t).attr("data-elementtypeid");r=$("#"+f).attr("data-BitValue");t.type=="radio"||t.type=="checkbox"?n.push({id:t.id,value:t.checked,bitvalue:r,ElementTypeId:i}):t.type=="select-one"?n.push({id:t.id,value:t.value,bitvalue:r,ElementTypeId:i}):t.type=="select-multiple"?n.push({id:t.id,value:t.value==null||t.value==""?"":JSON.stringify($(t).val()),ElementTypeId:i}):t.type=="text"||t.type=="email"||t.type=="textarea"||t.type=="image"||t.type=="number"?$(t).hasClass("k-input")||($(t).hasClass("dynamic-list-element")?(u=$("#"+t.id).data("kendoComboBox"),n.push({id:t.id,value:u.text(),ElementTypeId:i})):n.push({id:t.id,value:t.value,ElementTypeId:i})):$(this).hasClass("datepicker")&&n.push({id:t.id,value:t.value,ElementTypeId:i})})}),JSON.stringify(t)}function preSaveFormCheck(n){var t=$(n).attr("href");if($(n).hasClass("disabledLink"))return!1;dataHasChanged==!0&&saveForm(!1,null,!1,!1)}function SaveAndPrint(){saveForm(!1,null,!0,!1)}function PrintForm(){var r=$("#UserProjectFormId").val(),n=$("#printRedacted").prop("checked"),t=$("#printViewAsTable").is(":checked"),i="/Print/Form/"+r;(n||t)&&(i+="?redacted="+n+"&viewTabular="+t);window.open(i,"_blank")}function OpenPrintDialog(n){function i(n){t(n.Redaction);$("#printFormOverlay").on("hidden.bs.modal",function(){$("#printPDF button").focus()})}function r(){t(!1)}function t(n){var t=$("#printFormOverlay #printRedacted");u("#printRedacted",n);$("#printFormOverlay").modal("show")}function u(n,t){var i=$(n).parent("label");i.length==0&&(i=$(n));t?i.show():i.hide()}$.ajax({type:"POST",url:"/Print/Options",data:{UserProjectFormId:n},success:i,error:r})}function checkNumericValues(n){var i=parseInt(n.attr("data-numericrangemin")),r=parseInt(n.attr("data-numericrangemax")),t=parseInt(n.val());t!=""&&(t<i&&(t=i,n.val(t)),t>r&&(t=r,n.val(t)))}function saveForm(n,t,i,r){var s=getPanelSaveDataAsJson(),f=$("#PageId").val(),h=$("#UserProjectId").val(),e=$("#UserProjectFormId").val(),c=$("#FormId").val(),l=$("#isLockedByApplicant").val(),a=$("#isLockedByReviewer").val(),o=0,u;return typeof countdown=="object"&&(o=countdown.seconds),u="/Page/Save",r&&(u="/Page/SaveRepeatableSignatureRequest"),$.ajax({type:"POST",url:u,data:{pageData:s,id:f,userProjectFormId:e,elapsedTime:o},beforeSend:function(){$(".navigation li > a").addClass("disabledLink")},async:!1,success:function(r){var u=!1;if(r.MissingPanels.length>0&&$.each(r.MissingPanels,function(n,t){var i=$(".row[id="+t+"]");if(i){i.addClass("missing-panel").on("click",function(){$(this).removeClass("missing-panel")});u=!0}}),r.NewUserPanels.length>0&&$.each(r.NewUserPanels,function(n,t){var i=$(".row[data-id="+t.QuestionId+"][data-instance="+t.Instance+"]");i&&i.attr("data-userpanelid",t.UserPanelId)}),n==!0){if(u){$(".container-confirm").confirmModal({heading:Warning,body:Questions_marked_in_red_not_saved_correctly_wish_navigate,callback:function(){window.location=t}});return}window.location=t}else i==!0?(saveComplete(),window.open("/Print/Form/?userProjectFormId="+e,"_blank")):u?(showFeedback("failure",Questions_marked_in_red_not_saved_correctly),saveComplete()):r.IsCosting&&saveCostings(f);n||(showFeedback("success",Save_complete),getFormReference(),clearNotEnabledPanels());setDataHasChanged(!1)},error:function(){showFeedback("failure","Your updates were not saved due to an error on the page");n==!0&&(window.location=t)}})}function getCostingsIframe(){return document.getElementById("costing-iframe")}function saveCostings(n){const t=getCostingsIframe(),i={command:"saveForm",pageId:n.toString()};t.contentWindow.postMessage(i,"*")}function initialize(){var n=navigator.language.split("-")[0];n!=="en"&&setDatePickerLanguage[n]&&setDatePickerLanguage[n]();$(".panel-group-container").fadeIn().promise().done(function(){$(".panel-group .container").each(function(n,t){var i=$(t);i.find(".panel:visible").length==0&&i.parent().hide()})});$(":input[data-date='datepicker']").datepicker("destroy");$(":input[data-date='datepicker']").datepicker({changeMonth:!0,changeYear:!0,dateFormat:$("#DateFormat").val()});$(".datepicker").change(function(){var n=$(this).datepicker("getDate").toUTCString();$(this).attr("data-value",n)})}function reInitialize(){$(":input[data-date='datepicker']").each(function(){$(this).removeClass("hasDatepicker");$(this).datepicker({changeMonth:!0,changeYear:!0,dateFormat:$("#DateFormat").val()});$(this).change(function(){var n=$(this).datepicker("getDate").toUTCString();$(this).attr("data-value",n)});var n=$(this).attr("data-dateafter"),t=$(this).attr("data-datebefore"),i=$(this).attr("data-conditionId");i==eConditions.emDateNotIn?$(this).datepicker("option","beforeShowDay",function(i){var r=jQuery.datepicker.formatDate($("#DateFormat").val(),i);return[!(r>=n&&r<=t)]}):($(this).datepicker("option","minDate",n),$(this).datepicker("option","maxDate",t))})}function highlightPanel(n,t){var i=$(n).siblings(".rows-container");$(i).stop();$(i).animate({backgroundColor:t})}function unHighlightPanel(n,t){var i=$(n).siblings(".rows-container");$(i).stop();$(i).animate({backgroundColor:t})}function highlightRemovePanel(n,t){var i=$(n).siblings(".rows-container");t="#FF8484;";$(i).stop();$(i).animate({backgroundColor:t})}function unHighlightRemovePanel(n,t){var i=$(n).siblings(".rows-container");t="#FFF";$(i).stop();$(i).animate({backgroundColor:t})}function resetPanelIds(n){var t=$(n).children();$.each(t,function(n,t){var i,r;$(t).attr("data-instance",n+1);i=$(t).find(":input");$.each(i,function(t,i){var r=n+1;resetElementIdInstance(i,r)});r=$(t).find(".row");$.each(r,function(t,i){$(i).attr("data-instance",n+1)})})}function resetElementIdInstance(n,t){var r=$(n).attr("id"),i;r!=null&&setElementInstance(n,t,r,"id");i=$(n).attr("data-id");i!=null&&setElementInstance(n,t,i,"data-id")}function setElementInstance(n,t,i,r){var u=i.lastIndexOf("_"),f=i.substring(0,u),e=f+"_"+t;$(n).attr(r,e)}function removeLoading(){$(".exposeMask").css({display:"none"});$(".loading").css("display","none")}function showPopover(){$(".save-button").popover("show",setTimeout(function(){$(".save-button").popover("hide")},2e3))}function saveComplete(){$(".navigation li > a").removeClass("disabledLink")}function inputClick(n){var t,i,r;if((setDataHasChanged(!0),t=$(n).closest(".row"),$(n).attr("data-elementtypeid")=="8"&&$(n).is(":checked")&&(i=$(n).attr("id"),$(n).attr("data-exclusive").toLowerCase()=="true"?$("input:checkbox:not(#"+i+")",t).each(function(){$(this).prop("checked",!1)}):$('input:checkbox[data-exclusive="True"]',t).each(function(){$(this).prop("checked",!1)})),calculateAndAssignPanelValue(n),r=$($(n).parents(".row")[0]),$(n).attr("data-linkedquestion")&&$(n).attr("data-linkedquestion").length>0&&updateDynamicQuestion($(n)),t.attr("data-hasdependency")==undefined)||t.attr("data-hasdependency")!="True")return!1;DependenciesChangedModule.reset();calculatePanelDependencies(r);DependenciesChangedModule.speak();$(n).attr("data-linkedquestion")&&$(n).attr("data-linkedquestion").length>0&&updateDynamicQuestion($(n))}function calculatePanelDependencies(n){completedPanels=[];var t=n.attr("data-id");$(".panel-group").show();$.each(dependencies,function(n,i){var r=i.SourceQuestionId;if(r!=t)return!0;calculateDependencyTree(i)});$(".panel-group .container .panel").each(function(n,t){var i=$(t);i.find('.row[data-enabled="true"]').length==0?(i.hide(),$('.viewastable[data-panelastableid="'+i.attr("id")+'"]').length&&(showHideViewAsTableButton(),$('.viewastable[data-panelastableid="'+i.attr("id")+'"]').remove())):(i.closest(".panel-group").show(),i.show())});$(".panel-group .container").each(function(n,t){var i=$(t);i.find('.row[data-enabled="true"]').length==0&&i.parent().hide()});$(".document-table-container table tbody:not(:has(:visible))").parent("table").hide()}function calculateDependencyTree(n){var i=[],r=[],t=[];($(dependencyGroups).each(function(i,u){$(u.Contracts).each(function(i,u){var f=$(".row[data-id = "+u.SourceQuestionId+"]");f.each(function(i,r){if(u.SourceQuestionId==n.SourceQuestionId&&completedPanels.indexOf(n.SourceQuestionId)==-1){var f=!1;u.DependentPanelId==u.SourcePanelId?($.map(t,function(n){n.Id==u.DependentQuestionId&&n.Instance==$(r).attr("data-instance")&&(f=!0)}),f||t.push(new PanelInstanceItem(u.DependentQuestionId,$(r).attr("data-instance")))):($.map(t,function(n){n.Id==u.DependentQuestionId&&(n.Instance==$(r).attr("data-instance")||n.Instance==null)&&(f=!0)}),f||t.push(new PanelInstanceItem(u.DependentQuestionId,null)))}});u.SourceQuestionId==n.SourceQuestionId&&completedPanels.indexOf(n.SourceQuestionId)==-1&&r.indexOf(u.DependentQuestionId)==-1&&r.push(u.DependentQuestionId)})}),completedPanels.indexOf(n.SourceQuestionId)>-1)||(completedPanels.push(n.SourceQuestionId),$(t).each(function(n,t){$.map(dependencyGroups,function(n){n.DependentPanelId==t.Id&&(n.Instance=t.Instance,$(n.Contracts).each(function(n,i){i.Instance=t.Instance}),i.push(JSON.parse(JSON.stringify(n))))})}),i.length>0&&$(t).each(function(n,t){var f=[],r,u,e;if($(i).each(function(n,i){var r=[];i.DependentPanelId==t.Id&&i.Instance==t.Instance&&($(i.Contracts).each(function(n,t){var u=!1,i=$(".row[data-id = "+t.SourceQuestionId+"][data-instance="+t.Instance+"]"),f,e;(t.Instance==null||i.length==0&&t.TargetPanelId!=t.SourcePanelId)&&(i=$(".row[data-id = "+t.SourceQuestionId+"]"));f=[];i.attr("data-value")!=null&&i.attr("data-value")!=""&&(f=JSON.parse(i.attr("data-value")));e=t.RequiredValues;t.Type==2&&$.each(e,function(n,t){return $.each(f,function(n,i){if(t==i)return u=!0,!1}),u?!1:void 0});t.Type==1&&(u=arrayMatches(f,e));r.push(u)}),f.push(r))}),r=$(".row[data-id = "+t.Id+"][data-instance="+(t.Instance==null?"1":t.Instance)+"]"),t.Instance==null&&(r=$(".row[data-id = "+t.Id+"]")),u=!1,$.each(f,function(n,t){t.indexOf(!1)>-1||(u=!0)}),console.log("the panel is: "+r.attr("data-id")+" instance "+r.attr("data-instance")+" "+u),u){r.singleDependencyAction(1,!0);return}r.singleDependencyAction(1,!1);(r.attr("data-hasdependency")=="True"||r.find(".row").attr("data-hasdependency")=="True")&&(e=r.attr("data-id"),$.each(dependencies,function(n,t){var i=t.SourceQuestionId;if(i!=e)return!0;completedPanels.indexOf(i)==-1&&calculateDependencyTree(t)}))}))}function PanelInstanceItem(n,t){this.Id=n;this.Instance=t}function arrayMatches(n,t){var r={},u=!0,i;if(n.length!=t.length)return!1;for(i=0;i<n.length;i++)r[n[i]]||(r[n[i]]=0),r[n[i]]++;for(i=0;i<t.length;i++)if(r[t[i]]||(r[t[i]]=0),--r[t[i]]<0){u=!1;break}return u}function calculateDependencies(){iterateDependencies();resetDependencies()}function iterateDependencies(){$.each(panelArray,function(n,t){var i=t.sourcePanelId,r=$(".row[data-id = "+i+"]");$(".panel-group").show();$.each(t,function(n,t){$.each($(t),function(n,t){if(t.handled==!1){t.handled=!0;var i=t.targetPanelId,u=JSON.parse(t.ConditionTrueJson),f=t.dependencyActionId,s=t.dependencyType,e=$(".row[data-id="+i+"]"),o=JSON.parse($(r).attr("data-value"));$.each(u,function(n,t){$.each(o,function(n,i){t==i&&$(e).singleDependencyAction(f,!0)})})}})})})}function resetDependencies(){$.each(panelArray,function(n,t){$.each(t,function(n,t){$.each($(t),function(n,t){t.handled=!1})})});$(".panel-group .container").each(function(n,t){var i=$(t);i.find(".row:visible").length==0&&i.parent().hide()});$(".document-table-container table tbody:not(:has(:visible))").parent("table").hide()}function checkChangedData(){$("#page-form :input").change(function(){setDataHasChanged(!0)})}function enableOrDisableUploadDocument(n){var t=$(n).attr("data-MaxInstanceCount")>1?!0:!1,i=$(n).find(".rows-container .row");i.each(function(){var i=$(this).find(".document-table-container table tbody tr"),n=$(this).find(".btn-forms-document"),r=$("#isLockedByApplicant").val(),u=$("#isLockedByReviewer").val();t==!1&&i.length>=1||r=="true"||u=="true"?$(n).hide():$(this).find(".row").length>1&&i.length>=1?$(n).hide():$(n).show().removeAttr("disabled")})}function displaySignatures(){var n=[],t=[];$(".signature-display, .signature-request-display").hide();$(".signature-container .request-button").removeAttr("disabled").attr("onclick","requestSignatureOverlay(this, true)");$(".signature-container .sign-button").removeAttr("disabled").attr("onclick","signFormOverlay(this)");var i=$('#page-form .panel[data-enabled="true"] .signature-request-container input.signature-request-input'),r=$('#page-form  .panel[data-enabled="true"] .signature-container input.signature-input'),u=$("#page-form .signature-request-container input.signature-request-input").filter(function(){return $(this).val()>0}),f=$("#page-form .signature-container input.signature-input").filter(function(){return $(this).val()>0});(i.length>0||r.length>0)&&($.each(i,function(t,i){n.push($(i).attr("id"))}),$.each(u,function(n,t){$(t).parents(".panel").find(".remove-new").hide()}),$.each(f,function(n,t){$(t).parents(".panel").find(".remove-new").hide()}),$.each(r,function(n,i){t.push($(i).attr("id"))}),$.ajax({type:"POST",url:"/Signature/GetPageSignaturesAndRequests/",data:{signatureIds:t,signatureRequestIds:n,__RequestVerificationToken:"",userProjectFormId:userProjectFormId},traditional:!0,success:function(n){$.each(n.SignatureRequests,function(n,t){var r=$("#"+t.RequestElementId),u=r.parents(".panel").find(".signature-container .btn");r.parents(".panel").find(".remove-new").hide();var i=r.siblings(".alert"),f=i.find(".signatory"),e=i.find(".requested-date");f.text(t.SignatoryEmail+" ");e.text(t.RequestDateString);i.show();i.parents(".element-container").css("margin-top","0");u.attr("disabled","disabled").unbind().removeAttr("onclick")});$.each(n.Signatures,function(n,t){var r=$("#"+t.SignatureElementId),u=r.siblings(".btn"),i=r.siblings(".alert"),f=i.find(".signatory"),e=i.find(".signed-date");r.parents(".panel").find(".remove-new").hide();f.text(t.SignatoryFullName+" ("+t.Signatory.Email+") ");e.text(t.SignedDateString);i.show();i.parents(".element-container").css("margin-top","0");u.attr("disabled","disabled").unbind().removeAttr("onclick")})}}))}function scrollToTrackChangesQuestion(n,t,i){if(n!=""&&t!=""&&i!=""){var u=document.querySelector("#panel_"+n+'[data-instance="'+i+'"]'),r=u.querySelector("#question_"+t),f=$(r).position().top,e=$(r).find('div[data-mandatory="True"]');$("html,body").animate({scrollTop:$(r).offset().top-($(window).height()-$(r).outerHeight(!0))/2},200);r.classList.add("mandatory")}}function SaveNewUserContactBook(n){var i=$("#UserProjectFormId").val(),t=$(n).parents(".panel"),r=t.attr("id"),u=t.attr("data-instance");SaveUserContactBook(i,r,u,0,!0)}function UpdateUserContactBook(){var n=$("#updateUserContactBook-overlay"),t=$(n).attr("data-userProjectFormId"),i=$(n).attr("data-panelId"),r=$(n).attr("data-instance"),u=$(n).attr("data-userContactBookId");SaveUserContactBook(t,i,r,u,!1)}function SaveUserContactBook(n,t,i,r,u){var f=$(".panel[id='"+t+"'][data-instance='"+i+"']"),e=getPanelSaveDataAsJson(f);return u==!1&&r<=0?!1:$.ajax({type:"POST",url:"/UserContactBook/SaveFromPanel/",data:{contactPanelData:e,userProjectFormId:n,userContactBookId:r,isSaveNewAction:u},traditional:!0,beforeSend:function(){$(".navigation li > a").addClass("disabledLink")},async:!1,error:function(){showFeedback("failure",UserContactBook_Save_Failed)},success:function(t){if(t.IsSaveNewAction)if(t.Success)showFeedback("success",t.Message);else if(t.IsExistingContact){var i=$("#updateUserContactBook-overlay");$(i).attr("data-userContactBookId",t.UserContactBookId);$(i).attr("data-panelId",f.attr("id"));$(i).attr("data-instance",f.attr("data-instance"));$(i).attr("data-userProjectFormId",n);$(i).modal("show")}else showFeedback("error",t.Message);else t.Success?showFeedback("success",t.Message):showFeedback("error",t.Message),$("#updateUserContactBook-overlay").modal("hide")}})}function LoadUserContactBook(n){var f=$("#UserProjectFormId").val(),i=$(n).closest(".panel"),e=getPanelSaveDataAsJson(i),r=$(i).attr("id"),u=parseInt($(i).attr("data-instance")),t;refreshUserContactBookTable();t=$("#userContactBook-overlay");$(t).attr("data-panelId",r);$(t).attr("data-panelInstance",u);$(t).modal("show");$(t).on("hidden.bs.modal",function(){$(n).focus()})}function refreshUserContactBookTable(){getUserContactBookTable().then(function(n){$("#userContactBook-container").html(n);setUpUserContactBookTable();$("#userContactBook-table_filter input").attr("placeholder",Search_Contacts);$("#userContactBook-table_filter input").attr("style","width:350px !important;")})}function getUserContactBookTable(){return $.ajax({type:"POST",url:"/Project/GetUserContactBookTable/"})}function setUpUserContactBookTable(){dataTable=DataTablesInitClientside({tableSelector:"#userContactBook-container table",aoColumns:[{bSearchable:!1,bSortable:!1},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0}],noneFoundMsg:No_Items_Found})}function ChooseUserContactBook(n){var i=$("#UserProjectFormId").val(),t=$("#userContactBook-overlay"),r=$(t).attr("data-panelId"),u=$(t).attr("data-panelInstance"),f=$("div").find("[data-id='"+r+"'][data-instance='"+u+"']"),e=getPanelSaveDataAsJson(f);return $.ajax({type:"POST",url:"/UserContactBook/LoadToPanel/",data:{contactPanelData:e,userProjectFormId:i,userContactBookId:n},traditional:!0,beforeSend:function(){$(".navigation li > a").addClass("disabledLink")},async:!1,error:function(){showFeedback("failure",UserContactBook_Load_Failed)},success:function(n){for(var t,i=0;i<n.length;++i)t=n[i],$("#"+t.Id).val(t.Value),$("#"+t.Id).prop("type")=="select-one"&&inputClick($("#"+t.Id));setDataHasChanged(!0);showFeedback("success",UserContactBook_Load_Success);$("#userContactBook-overlay").modal("hide")}})}function loadCommentOverlay(n){loadPanelGroup(userProjectFormId,n);$("#formCommentsPanel").attr("data-panelGroupId",n);$("#formCommentsPanel").modal("show");$("#formCommentsPanel").on("hidden.bs.modal",function(){$("#formCommentButton_"+n+" :button").focus()})}function loadPanelGroup(n,t){$("#formCommentsPanel-table tbody").empty();$.ajax({url:"/Page/GetPanelComments/",type:"GET",data:{panelGroupId:t,userProjectFormId:n},success:function(n){ShowHideFormCommentsPanelTable(n.length);$.each(n,function(n,t){addRowToCommentsPanelTable(t,!1)})}})}function editUnlock(){editLocked=!1}function unlock(){locked=!1}function addRowToCommentsPanelTable(n){var i=$("<tr>").addClass("formCommentsPanel").attr({"data-belongsToUser":n.IsOwner,"data-id":n.FormPanelCommentId,"data-candelete":n.CanDelete&&!n.IsOwner}),o=$("#formCommentsPanel-table"),f=$("<td>").addClass("commentPanel-text"),s='<div class="details" style="display: block;">'+n.Comment.replace(/\n/g,"<br/>")+"<\/div>",e,t,r,u;f.html(s);e=$("<td>").addClass("commentPanel-dateAdded").text(n.FormattedDate).attr("title",Last_Update+" "+n.FormattedDate);t=$("<td>");n.IsOwner==!0?$(t).addClass("commentPanel-user").html(You):$(t).addClass("commentPanel-user").html(n.User);$(i).append(f,e,t);(n.IsOwner==!0||n.CanDelete)&&(r=$("<td>").addClass("commentPanel-edit").css("cursor","pointer"),r.html(`<button type="button" class="btn btn-primary" onclick="showUpsertFormCommentPanelModal(${n.FormPanelCommentId}, ${n.UserProjectFormId}, ${n.PanelGroupId})" aria-label="Edit comment">Edit</button>`),u=$("<td>").addClass("commentPanel-delete").css("cursor","pointer"),u.html(`<button type="button" class="btn btn-danger" onclick="deleteFormCommentPanel(${n.FormPanelCommentId})" aria-label="Delete comment">Delete</button>`),$(i).append(r,u));$(o).append(i)}function ShowHideFormCommentsPanelTable(n){n==0?($("#no-commentsPanel-alert").show(),$("#formCommentsPanel-table").hide(),$("#formCommentsPanel-options-table").hide()):($("#formCommentsPanel-table").show(),$("#formCommentsPanel-options-table").show(),$("#no-commentsPanel-alert").hide())}function updatePanelCount(n){console.log("rowCount - "+n);var t=$("#formCommentsPanel").attr("data-panelGroupId");console.log("panelGroupId - "+t);$("#stickynote_"+t).html(n);ShowHideFormCommentsPanelTable(n)}function CancelFormCommentPanel(n,t){var i=$("#formCommentsPanel-table tr[data-id="+t+"]"),u=i.find("textarea"),r;u.remove();r='<div class="details" style="display:block;">'+n.replace(/\n/g,"<br/>")+"<\/div>";i.find(".commentPanel-text").html(r);editUnlock();setTimeout(function(){i.on("click",commentsRowPanelClick)},1e3)}function ViewOverallPanelCommentsModal(){getOverallPanelCommentsTable();$("#ViewOverallPanelComments").modal("show");$("#ViewOverallPanelComments").on("hidden.bs.modal",function(){$("#view-comments button").focus()})}function getOverallPanelCommentsTable(){setOverallPanelComments().then(function(n){$("#OverallPanelComments-container").html(n);setUpOverallPanelCommentsTable()})}function setOverallPanelComments(){return $.ajax({type:"POST",url:"/Project/GetOverallPanelCommentsTable/",data:{userProjectFormId:userProjectFormId}})}function setUpOverallPanelCommentsTable(){dataTable=DataTablesInitClientside({tableSelector:"#OverallPanelComments-container table",aoColumns:[{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0},{bSearchable:!0,bSortable:!0}],noneFoundMsg:No_Items_Found,searchPlaceholder:Search_Comment});$(".view-panelGroup").click(function(n){n.stopPropagation();var u=$(this).parents("tr"),t=$(this).parents("tr").attr("data-panelGroupId"),i=$(this).parents("tr").attr("data-pageId"),r="/Project/Page/"+i+"/"+userProjectFormId+"?panelId=group_"+t;window.location.href=r})}function LoadSharedPanelFormsInfo(n){var i=$("#UserProjectFormId").val(),r=$(n).attr("data-id"),t=!1;$(n).parents(".panel").find(":disabled").length&&(t=!0);$.getJSON("/Page/GetSharedQuestionForms/",{userProjectFormId:i,panelId:r,isPanelLocked:t},function(n){var u=$("#sharedPanelFormsInfo-table-container"),t,r,i,f;for(u.empty(),t='<table id="sharedforms-table" class="table table-striped">',r=0;r<n.Forms.length;r++)t=t+"<tr><td>"+n.Forms[r]+"<\/td><\/tr>";t=t+"<\/table>";u.append(t);i=$(" #sharedPanelFormsInfo-overlay .alert-info");i.empty();i.addClass("displayNone");n.PanelLockDescription!=null&&(i.append(n.PanelLockDescription),i.removeClass("displayNone"));f=$("#sharedPanelFormsInfo-overlay");$(f).modal("show")})}function clearNotEnabledPanels(){var n=$("#page-form .panel");$.each(n,function(){$(this).is(":visible")==!1&&$(this).attr("data-isdocument").toLowerCase()=="true"&&($(this).hide(),$(this).attr("date-value","0"),$(this).attr("data-enabled",!1),$("div.document-table-container table > tbody",$(this)).empty(),$(this).attr("data-maxinstancecount").toLowerCase()=="1"&&$("a.btn-forms-document",$(this)).show().removeAttr("disabled"))})}function GetDocumentAttachment(n,t){t.stopPropagation();var i=$(n).attr("data-attachmentId");ViewDocumentAttachment(i)}function ViewDocumentAttachment(n){const t=n>0;t&&DisplayHtmlDocument(n,"/Notifications/GetGeneratedDocumentHtml","/Notifications/Document/","Attachment")}function DisplayHtmlDocument(n,t,i,r){function u(t){var u,f,e;t!=""&&(u=$("#viewTemplate-modal"),clearModalBody(u),u.find(".modal-title").text(r),f=$(document.createElement("div")),$(f).append(t),$("#viewTemplate-modal .modal-body").append(f),e=$("#viewTemplate-modal .modal-footer #templateDownload"),$(e).click(function(){window.location=i+n}),u.modal("show"))}$.ajax({url:t,data:{attachmentId:n},type:"POST",success:u})}function MandatoryFieldsSchema(n,t,i,r){this.QuestionId=n;this.Version=t;this.DocumentDate=i;this.DocumentVersion=r}function HideTheSubmitButton(){$("#submit-tile").hide()}function OpenSubmitFormModal(){ResetSubmitFormModal();showPopupOverlay($("#complete-overlay"))}function ResetSubmitFormModal(){var n=document.getElementById("completemessage"),t,i;n!=null&&(n.innerHTML="",n.style.display="none",n.style.color="green");t=document.getElementById("checkformbutton");t!=null&&(t.style.display="block");i=document.getElementById("submitbutton");i!=null&&(i.style.visibility="hidden")}function submitForm(n){return dataHasChanged==!0&&saveForm(!1,null,!1,!1),$("#submitbutton").prop("disabled",!0),showPopupOverlay($("#checkcomplete-overlay")),$.ajax({type:"POST",url:"/Submission/Submit/",data:{userProjectFormId:userProjectFormId,isAutoSubmission:n,signalRConnectionId:signalRConnections.connectionId},success:function(n){n.Success?setTimeout(function(){window.location="/Project/FormSubmitted/"+userProjectFormId+"?submissionId="+n.OutputSubmissionId},100):(hidePopupOverlay(),showFeedback("failure",Form_Incomplete))},error:function(){hidePopupOverlay();showFeedback("failure",Unexpected_Error)}}),!1}function completeForm(){return dataHasChanged==!0&&saveForm(!1,null,!1,!1),$("#submitbutton").prop("disabled",!0),showPopupOverlay($("#checkcomplete-overlay")),$.ajax({type:"POST",url:"/Submission/SetFormComplete/",data:{userProjectFormId:userProjectFormId},success:function(n){n.Blockers.length==0?setTimeout(function(){window.location="/Project/FormSubmitted/"+userProjectFormId},100):(showFeedback("success","Form set to complete"),$("#checkcomplete-overlay").modal("hide"),hidePopupOverlay(),checkFormIsComplete())},error:function(){hidePopupOverlay();showFeedback("failure",Unexpected_Error)}}),!1}function getSubmissionHistory(){return formId==undefined?!1:($.ajax({type:"POST",url:"/Submission/GetSubmissionHistory/",data:{userProjectId:userProjectId,formId:formId},success:function(n){createSubmissionHistoryUI(n)},error:function(){showFeedback("failure",Unexpected_Error)}}),!1)}function createSubmissionHistoryUI(n){var t=$("#submission-rows");$("#submission-rows").find("tr").remove();n.length==0&&(document.getElementById("submission-history-div").style.visibility="hidden");$.each(n,function(n,i){var r='<tr class=""><td>'+i.ReviewReference+"<\/td><td>"+i.SubmissionCode+"<\/td><td>"+i.SubmissionDateString+"<\/td><td>"+i.UserProjectId+"<\/td><td>"+i.Status+'<\/td><td><a class="btn" onclick="ViewPDF('+i.SubmissionId+","+i.UserProjectFormId+')">'+View+"<\/a><\/td><\/tr>";$(t).append(r)})}function getSignatures(){return formId==undefined?!1:($.ajax({type:"POST",url:"/Submission/GetSignatures/",data:{userProjectFormId:userProjectFormId},success:function(n){createSignaturesUI(n)},error:function(){showFeedback("failure",Unexpected_Error)}}),!1)}function getFormSignatureRequests(){return $.ajax({type:"GET",dataType:"html",url:"/Signature/GetFormSignatureRequests/",data:{userProjectFormId:userProjectFormId,__RequestVerificationToken:""}})}function getFormSignatures(){return $.ajax({type:"GET",dataType:"html",url:"/Signature/GetFormSignatures/",data:{userProjectFormId:userProjectFormId,__RequestVerificationToken:""}})}function createSignaturesUI(n){var t=$("#signature-rows");n.length==0&&(document.getElementById("signature-history-div").style.visibility="hidden");$.each(n,function(n,i){var r='<tr class=""><td>'+i.Description+"<\/td><td>"+format(i.SignedDate)+"<\/td><td>"+i.SignatureStatus+'<\/td><td><a class="btn" onclick="Request('+i.Id+')">Request<\/a><\/td><td><a class="btn" onclick="Sign('+i.Id+')"> '+Sign+"<\/a><\/td><\/tr>";$(t).append(r)})}function ViewPDF(n,t){return document.getElementById("submissionid").value=n,$(".txtUserProjectFormId").val(t),$("#submission-form").submit(),!1}function format(n){if(n!=null){var t=new Date(parseInt(n.substr(6))),i=t.getMonth().length+1===1?t.getMonth()+1:t.getMonth()+1;return t.getDate()+"/"+i+"/"+t.getFullYear()}return""}function requestSignature(){var t=$("#signatureEmail").val(),r=$("#signatureMessage").val(),i=$("#signatureMessage").val().length,n;return t==""?(showFeedback("failure","Please enter your signatory's email address"),!1):i>800?(showFeedback("failure","The message is too long, must be below 800 characters."),!1):(showPopupOverlay($("#signature-request-overlay")),$("<input type='text' value="+signalRConnections.connectionId+" />").attr("id","SignalRConnectionId").attr("name","SignalRConnectionId").attr("style","display:none").appendTo("#signature-request-form"),n=$("#signature-request-form").serializeArray(),$.ajax({type:"POST",traditional:!0,url:"/Signature/RequestSignature/",data:n,success:function(n){n.Success?(actuallyHideSignatureOverlay(),hidePopupOverlay(),showFeedback("success","Request Sent"),$("#"+$("#RequestElementId").val()).val(n.SignatureRequestId),displaySignatures(),checkLocked(),getFormActions(),getFormSignatureRequests(),$("#signatureEmail").val(""),$("#signatureMessage").val(""),setDataHasChanged(!1)):(hidePopupOverlay(),showFeedback("failure",n.ErrorMessage))},error:function(){showFeedback("failure",Unexpected_Error)}}),!1)}function cancelRequest(n){var t=$(n).parents("tr").attr("data-id"),i=$(n).parents("tr").attr("data-element");$.ajax({type:"POST",url:"/Signature/CancelRequest/",data:{userProjectFormId:userProjectFormId,requestId:t},success:function(n){var r,t;if(n.Success==!1)return showFeedback("failure",n.ErrorMessage),!1;r=n.RemainingRequests;$("#signature-list-overlay").length>0&&$("#signature-list-overlay").modal("hide");t=$("#"+i);t.val("");t.parents(".panel").find(".remove-new").show();displaySignatures();getFormSignatureRequests().then(function(n){$("#form-signatureRequests-container").html(n)});showFeedback("success","Signature request cancelled");r==0&&unlockForm()}})}function signForm(n){var t=$(n),i=t.siblings(".signature-input"),r=i.attr("id"),u=t.attr("data-signaturetypeid"),f=t.parents(".row").attr("data-id"),e=$("#signatureOverlay #user-sign-username").val(),o=$("#signatureOverlay #user-sign-password").val();$("#signFormButton").prop("disabled",!0);$.ajax({type:"POST",url:"/Signature/SignForm/",data:{userProjectFormId:userProjectFormId,signatureTypeId:u,elementId:r,panelId:f,userName:e,password:o,signalRConnectionId:signalRConnections.connectionId},success:function(n){showFeedback("success","Signature successful");$("#signFormCloseButton").show();$("#signFormCancelButton").show();hidePopupOverlay($("#signatureOverlay"));$("#signFormButtonTemp").hide();$("#signFormButton").show();$("#signFormButton").prop("disabled",!1);$.ajax({type:"POST",url:"/Sessionless/GeneratePDFAfterUserSignature/",data:{userSignatureId:n.SignatureId},success:function(){},error:function(){}});n.RedirectURL==""?($("#signatureOverlay").modal("hide"),i.val(Data.SignatureId),checkLocked(),getFormActions(),displaySignatures(),getFormSignatures(),getFormSignatureRequests(),$("#user-sign-username").val(""),$("#user-sign-password").val(""),setDataHasChanged(!1)):($("#signatureOverlay").modal("hide"),setTimeout(function(){window.location=n.RedirectUrl},400))},error:function(n){$("#signFormCloseButton").show();$("#signFormCancelButton").show();hidePopupOverlay($("#signatureOverlay"));$("#signFormButtonTemp").hide();$("#signFormButton").show();$("#signFormButton").prop("disabled",!1);showFeedback("failure",n.responseText.replace(/\"/g,""))}})}function showSignatureList(n){$.when(getFormSignatureRequests().then(function(n){$("#signature-requests-container").html(n)}),getFormSignatures().then(function(n){$("#signatures-container").html(n)})).then(function(){if(n!=null){var i=$(n).siblings("input").attr("id"),t=$("#signature-list-overlay .modal-body table tr[data-element="+i+"]").first();$(t).addClass("selected");$(t).fadeIn(1e3,function(){setTimeout(function(){$(t).removeClass("selected")},3e3)})}});$("#signature-list-overlay").modal("show");$("#signature-list-overlay").on("hidden.bs.modal",function(){$("#signatures-tile button").focus()})}function checkFormIsComplete(){$("#complete-overlay").modal("show");checkComplete()}function checkFormIsCompleteFromIndex(){var n=$("#checkincompleteAnimal");n.hide();animalhasChanged==!0&&(animalhasChanged=!1,$("#leftBtnContainer").fadeOut(),saveAnimalDataForm(event,!1));checkComplete().then(function(){$("#submissionstateholder").unbind("hidden.bs.modal");$("#submissionstateholder").on("hidden.bs.modal",function(){$("#check-tile button").focus()})})}function checkFormIsCompleteFromPage(){checkComplete().then(function(){$("#submissionstateholder").unbind("hidden.bs.modal");$("#submissionstateholder").on("hidden.bs.modal",function(){$("#check-tile button").focus()})})}function checkLocked(){return $.ajax({type:"GET",url:"/Project/CheckLocked/",data:{userProjectFormId:userProjectFormId,__RequestVerificationToken:""},success:function(n){var t=n.LockedByApplicant,i=n.LockedByReviewer;$("#isLockedByApplicant").val(t);$("#isLockedByReviewer").val(i);($("#isLockedByApplicant").val(t)=="true"||$("#isLockedByReviewer").val(i)=="true")&&setDataHasChanged(!1);applyFormAccessRestrictions()}})}function unlockFormQuestion(){$("#unlock-form-modal").modal("show");$("#unlock-form-modal").on("hidden.bs.modal",function(){$("#unlock-tile button").focus()})}function confirmUnlockForm(){$("#unlock-form-modal").modal("hide");unlockForm()}function unlockForm(){$.ajax({type:"POST",url:"/Project/unlockForm/",data:{userProjectFormId:userProjectFormId,signalRConnectionId:signalRConnections.connectionId},success:function(){$("#isLockedByApplicant").val("false");$("#isLockedByReviewer").val("false");applyFormAccessRestrictions();getFormActions().then(function(){removeSignaturesAndRequestsFromPage();setUpSignatureAndRequestButtonHandlers()});showFeedback("success","Form unlocked")}})}function removeSignaturesAndRequestsFromPage(){$(".signature-request-input").val("");$(".signature-input").val("");$(".signature-request-display").hide();$(".signature-display").hide()}function setUpSignatureAndRequestButtonHandlers(){$("#page-form .request-button").removeAttr("disabled").attr("onclick","requestSignatureOverlay(this, true)");$("#page-form .sign-button").removeAttr("disabled").attr("onclick","signFormOverlay(this)")}function nonOwnerSignatureCount(){$.ajax({type:"GET",url:"/Signature/SignatorySignatureCount/",data:{userProjectFormId:userProjectFormId},success:function(n){n>1?$.ajax({type:"GET",url:"/Signature/SignatorySignatureModalView/",data:{userProjectFormId:userProjectFormId,version:$("#Version").val()},success:function(n){$("#signatorySignatureList #signature-list").html("");$("#signatorySignatureList #signature-list").html(n);$("#signatorySignatureList").modal("show")},error:function(n){showFeedback("failure","Error finding signature request");console.log("AJAX error in request: "+JSON.stringify(n,null,2))}}):$.ajax({type:"GET",url:"/Signature/SingleSignatureDeclaration/",data:{userProjectFormId:userProjectFormId,version:$("#Version").val()},success:function(n){nonOwnerSignatureOverlay(n.Declaration,n.SignatureRequestId)},error:function(n){showFeedback("failure","Error finding signature request");console.log("AJAX error in request: "+JSON.stringify(n,null,2))}})},error:function(){showFeedback("failure","Error finding signature request");console.log("AJAX error in request: "+JSON.stringify(err,null,2))}})}function nonOwnerSignatureOverlay(n,t){if($("#signatureRequestId").val(t),$("#signatorySignatureList").modal("hide"),n.length<5){$("#nonOwner-signatureOverlay").modal("show");return}var i=n;i.length>5?($("#signatureDeclarationOverlay").modal("show"),$("#signatureDeclarationOverlay #signature-declaration-text").html(""),$("#signatureDeclarationOverlay #signature-declaration-text").html(i),$("#signatureDeclarationOverlay #acceptDeclarationButton").unbind().click(function(){$("#signatureDeclarationOverlay").modal("hide");$("#nonOwner-signatureOverlay").modal("show")})):$("#nonOwner-signatureOverlay").modal("show")}function signFormOverlay(n){var t=$(n),i,r;$("#hiddenCanSubmit").val()=="True"&&(i=$("#signincompleteAnimal"),i.hide(),$("#complete-overlay").modal("show"),hideBetaTestButtons(),r=$(n).parent().find(".signature-input").attr("id"),checkCompleteForSignature(r).then(function(){setTimeout(function(){$("#signatureOverlay").is(":visible")&&($("#signatureOverlay #signFormButton").prop("disabled",!0),checkSignatureDeclarations(n))},200)}).then(function(){$("#checkcomplete-overlay").on("hidden.bs.modal",function(){t.focus()});$("#submissionstateholder").on("hidden.bs.modal",function(){t.focus()})}))}function signFormModal(n){$("#signatureOverlay").modal("show");$("#signatureOverlay #signFormButton").prop("disabled",!1);$("#signatureOverlay #signFormButton").unbind().click(function(){$("#signFormCloseButton").hide();$("#signFormCancelButton").hide();$(this).hide();$("#signFormButtonTemp").show();signForm(n)})}function checkSignatureDeclarations(n){var t=$(n).closest(".row").attr("data-signaturedeclaration").trim();t.length>5?($("#signatureOverlay").modal("hide"),$("#signatureDeclarationOverlay").modal("show"),$("#signatureDeclarationOverlay #signature-declaration-text").html(""),$("#signatureDeclarationOverlay #signature-declaration-text").html(t),$("#signatureDeclarationOverlay #acceptDeclarationButton").unbind().click(function(){$("#signatureDeclarationOverlay").modal("hide");$("#AutoSubmissionEnabled").val()=="True"&&$("#signatureOverlay #autosubmissionalert").show();signFormModal(n)})):($("#AutoSubmissionEnabled").val()=="True"&&$("#signatureOverlay #autosubmissionalert").show(),signFormModal(n));$("#complete-overlay").modal("hide")}function signAnyway(n){$("#AutoSubmissionEnabled").val()=="True"&&$("#signatureOverlay #autosubmissionalert").show();$.ajax({url:"/Project/GetSignaturePartialView",success:function(t){$(".container-inner").append(t);$("#signatureOverlay").modal("show");$("#complete-overlay").modal("hide");$("#checkcomplete-overlay").modal("hide");n=$("#"+n).siblings().prev(".btn");$("#signatureOverlay #signFormButton").unbind().click(function(){$("#signFormCloseButton").hide();$("#signFormCancelButton").hide();showPopupOverlay($("#signatureOverlay"));$(this).hide();$("#signFormButtonTemp").show();signForm(n)})},error:function(){}})}function requestSignatureAnyway(){CheckIfAutoSubmitIsEnabled();$.ajax({url:"/Signature/GetRequestModal/",traditional:!0,data:$("#requestanywayform").serialize(),success:function(n){$("#complete-overlay").modal("hide");$("#submissionstateholder").html(n).find(".modal").modal("show")},error:function(){showFeedback("failure","An Error has Occurred")}});$("#signature-request-overlay").modal("show");setSearchInputs();$("#checkcomplete-overlay").modal("hide")}function hideBetaTestButtons(){$("#signAnywayButton").hide();$("#requestSignatureAnywayButton").hide()}function nonOwnerSignForm(){$("#btnNonOwnerSignForm").hide();$("#btnNonOwnerSignFormClose").hide();$("#btnNonOwnerSignFormCloseX").hide();showPopupOverlay($("#nonOwner-signatureOverlay"));var n=$("#nonOwner-signatureOverlay #sign-username").val(),t=$("#nonOwner-signatureOverlay #sign-password").val();usingAdfs==!1&&(n==""||t=="")?(showFeedback("failure","Please enter your username and password"),$("#btnNonOwnerSignForm").show(),$("#btnNonOwnerSignFormClose").show(),$("#btnNonOwnerSignFormCloseX").show(),hidePopupOverlay($("#nonOwner-signatureOverlay"))):$.ajax({type:"POST",url:"/Signature/SignForm/",data:{userName:n,signatureRequestId:$("#signatureRequestId").val(),password:t,userProjectFormId:userProjectFormId,signalRConnectionId:signalRConnections.connectionId},success:function(n){$("#btnNonOwnerSignForm").show();$("#btnNonOwnerSignFormClose").show();$("#btnNonOwnerSignFormCloseX").show();hidePopupOverlay($("#nonOwner-signatureOverlay"));$("#nonOwner-signatureOverlay").modal("hide");$.ajax({type:"POST",url:"/Sessionless/GeneratePDFAfterUserSignature/",data:{userSignatureId:n.SignatureId},success:function(){},error:function(){}});showFeedback("success","Form signed successfully").then(function(){setTimeout(function(){window.location=n.RedirectUrl},500)})},error:function(n){$("#btnNonOwnerSignForm").show();$("#btnNonOwnerSignFormClose").show();$("#btnNonOwnerSignFormCloseX").show();hidePopupOverlay($("#nonOwner-signatureOverlay"));showFeedback("failure",n.responseText.replace(/\"/g,""))}})}function getSignedPdf(n){$.ajax({type:"POST",url:"/Signature/CreateSignaturePdf/",async:!0,data:{signatureId:n},beforeSend:function(){showInProgressFeedback("Please wait: Generating pdf...");$("#signatures-tile").hide();$("#signaturesReject-tile").hide()},success:function(){window.location="/signatures/index/1"},error:function(){window.location="/signatures/index/1"}})}function nonOwnerRejectionOverlay(){$("#nonOwner-rejectionOverlay").modal("show")}function nonOwnerRejectForm(){var n=$("#nonOwner-rejectionOverlay #reject-username").val(),t=$("#nonOwner-rejectionOverlay #reject-password").val(),r=$("#reject-reason").val(),u=$("#reject-reason").val().length,i;if(u>800)return showFeedback("failure","The message is too long, must be below 800 characters."),!1;usingAdfs==!1&&(n==""||t=="")?showFeedback("failure","Please enter your username and password"):(i={userName:n,password:t,reason:r,userProjectFormId:userProjectFormId},$.ajax({type:"POST",url:"/Signature/RejectFormAsSignatory/",data:i,success:function(n){n=="Success"?($("#nonOwner-rejectionOverlay").modal("hide"),showFeedback("success","Form Rejected successfully").done(function(){window.location="/signatures/index/1"})):showFeedback("failure",n.error||"Unable to reject form, ensure your username and password are correct")},error:function(){showFeedback("failure","Unable to reject form, please contact your system administrator")}}))}function NavigateActionAdd(){var n="/Project/Index/"+userProjectFormId;$(".icon-location > a").attr("href",n);$("#navigate-tile a").click(OnEventSaveThenNavigate)}function CheckFormLockedClient(){var n=!1;return($("#isLockedByApplicant").val()=="true"||$("#isLockedByReviewer").val()=="true")&&(n=!0),n}function OnEventSaveThenNavigate(n){var t=$(this).attr("href");$(this).hasClass("disabledLink")?n.preventDefault():dataHasChanged==!0&&CheckFormLockedClient()==!1?(n.preventDefault(),saveForm(!0,t,!1,!1)):window.location=t}function NextActionAdd(){$("#next-tile a").click(OnEventSaveThenNavigate)}function PreviousActionAdd(){$("#previous-tile a").click(OnEventSaveThenNavigate)}function SwipeBindingForTablets(){var i=$("#next-tile a"),r=$("#previous-tile a"),n=i.attr("href"),t=r.attr("href");$("body").unbind().on("swipeleft",function(){typeof n=="undefined"?($("#container-main").css("position","relative"),$("#container-main").animate({left:"-80%"},200,function(){$("#container-main").animate({left:"0%"},200)})):$("#container-main").addClass("slideLeft",function(){setTimeout(function(){dataHasChanged==!0&&CheckFormLockedClient()==!1?saveForm(!0,n,!1,!1):window.location=n},500)})});$("body").on("swiperight",function(){typeof t=="undefined"?($("#container-main").css("position","relative"),$("#container-main").animate({right:"-180%"},200,function(){$("#container-main").animate({right:"0%"},200)})):$("#container-main").addClass("slideRight",function(){setTimeout(function(){dataHasChanged==!0&&CheckFormLockedClient==!1?saveForm(!0,t,!1,!1):window.location=t},500)})})}function checkComplete(){return $("#complete-overlay").modal("show"),dataHasChanged&&saveForm(!1,null,!1,!1),$.ajax({type:"POST",url:"/Submission/CheckFormIsComplete/",data:{userProjectFormId:userProjectFormId},success:function(n){$("#complete-overlay").modal("hide");$("#submissionstateholder").html(n).find(".modal").modal("show");$(".ui-draggable").draggable();$("#submissionstateholder").on("hidden.bs.modal",function(){$("#submit-tile button").focus()})},error:function(){showFeedback("failure",Unexpected_Error);$("#complete-overlay").modal("hide");$("#complete-overlay").on("hidden.bs.modal",function(){$("#submit-tile button").focus()})}})}function checkCompleteForSignature(n){return $("#complete-overlay").modal("show"),dataHasChanged&&saveForm(!1,null,!1,!1),$.ajax({type:"POST",url:"/Submission/CheckFormIsCompleteForSignature/",data:{userProjectFormId:userProjectFormId,elementid:n},success:function(n){$("#complete-overlay").modal("hide");$("#signatureOverlay").remove();$("#submissionstateholder").html(n).find(".modal").modal("show")},error:function(){showFeedback("failure",Unexpected_Error);$("#complete-overlay").modal("hide")}})}function checkCompleteForSignatureRequest(n,t,i,r){return $("#complete-overlay").modal("show"),dataHasChanged&&saveForm(!1,null,!1,!0),$.ajax({type:"POST",url:"/Submission/CheckFormIsCompleteForSignatureRequest/",data:{userProjectFormId:userProjectFormId,elementid:n,questionid:t,type:i,signatureelementid:r},success:function(n){$("#complete-overlay").modal("hide");$("#submissionstateholder").html(n).find(".modal").modal("show")},error:function(){showFeedback("failure",Unexpected_Error);$("#complete-overlay").modal("hide")}})}function requestSignatureOverlay(n){if($("#hiddenCanSubmit").val()=="True"){var t=$(n),i=t.parents(".row").find(".signature-container .signature-input"),r=t.parents(".row").find(".signature-request-container .signature-request-input"),u=r.attr("id"),f=t.parents(".row").attr("data-id"),e=t.attr("data-signatureTypeId"),o=i.attr("id");return checkCompleteForSignatureRequest(u,f,e,o).then(function(){$("#submissionstateholder").on("hidden.bs.modal",function(){$(n).focus()})}),!1}showFeedback("failure","The project owner must update your project in order to complete and sign this form.")}function actuallyHideSignatureOverlay(){return $("#signature-request-overlay").modal("hide"),!1}function hideSignatureOverlay(){setTimeout(actuallyHideSignatureOverlay,850);$("#signature-request-overlay").fadeOut(1e3,function(){})}function getDocuments(){var n=$("#UserProjectId").val(),t=$("#PageId").val(),i="/Page/Documents/"+t+"?userProjectId="+n;$.post(i,function(n){formDocumentsTable(n)})}function formDocumentsTable(n){var t=document.getElementById("documents-root");n="hello"}function testBrowserForAjaxFileUpload(){var n=!1,t;return(Function("/*@cc_on return /^10/.test(@_jscript_version) @*/")()&&(n=!0),n==!0)?!1:"undefined"==typeof FormData?!1:(t=new FormData,"undefined"==typeof t.append?!1:!0)}function postDocumentsFormAJAX(n,t){if(validateDocuments(n)){$("#document-form-upload").hide();$("#document-form-upload").siblings(".document-progress").show();var i="#"+$("#txtDocumentInputElementId").val();t.append("elementId",$("#txtDocumentInputElementId").val());t.append("userpanelid",$(i).closest(".row").attr("data-userpanelid"));t.append("version",$("#Version").val());t.append("instanceId",$(i).closest(".row").attr("data-instance"));$.ajax({url:"/Document/SaveDocument/",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",progressHandlingFunction,!1),n},success:function(n){displayNewUploadedDocument(n,i);documentUploadComplete();hidePopupOverlay()},error:function(){showFeedback("failure","Error uploading document");$("#document-form-upload").show();$(".document-progress").hide()},data:t,cache:!1,contentType:!1,processData:!1})}else hidePopupOverlay()}function postDocumentsFormNormal(){validateDocuments()?saveForm(!1,null,!1,!1).then(function(){$("#document-form").submit(function(){$("#documents-overlay").modal("hide");setTimeout(function(){location.reload()},6e3)});$("#txtUserDocumentDate").val($("#txtDocumentDate").val());$("#txtUserDocumentVersion").val($("#txtDocumentVersion").val());$("#txtUserDocumentCustomFileName").val($("#txtDocumentCustomFileName").val());$("#document-form").submit();refreshAllDocumentsTable()}):hidePopupOverlay()}function progressHandlingFunction(n){var t,i;n.lengthComputable&&($(".progress").attr({value:n.loaded,max:n.total}),t=n.loaded/n.total*100+"%",$(".document-progress .bar").css("width",t),t=="100%"&&(i=setTimeout(function(){documentReachedServer()},700)))}function documentReachedServer(){$(".document-upload-text").html(Processing+"...");$(".document-upload-text").show()}function documentUploadComplete(){$(".document-progress").hide();$(".document-progress").removeClass("progress-warning");$(".document-progress").addClass("progress-success");$(".document-upload-text").html(Complete);$(".document-upload-text").show();$(".document-progress").fadeIn();var n=setTimeout(function(){resetUpload()},1e3)}function handleFileSelect(n){var i,r,t;for(n.stopPropagation(),n.preventDefault(),$("#drop-box").css("background","none"),i=n.dataTransfer.files,r=new FormData($("#document-form")[0]),t=0;t<i.length;t++)r.append("upload",i[t]);postDocumentsFormAJAX(!0,r)}function handleDragOver(n){n.stopPropagation();n.preventDefault();n.dataTransfer.dropEffect="move";$("#drop-box").css("background","#ECFCFF")}function handleDragLeave(n){n.stopPropagation();n.preventDefault();$("#drop-box").css("background","none")}function resetUpload(){$(".document-progress").hide();$("#document-form-upload").fadeIn(function(){$("#documents-overlay").modal("hide")});$(".document-upload-text").hide();$(".document-progress .bar").css("width","0%");$(".document-progress").removeClass("progress-success");$(".document-progress").addClass("progress-warning");$("#document-form")[0].reset()}function validateDocuments(n){var i=CheckMandatoryFields(),t,r;return $("#originalFileName").html().length>175?(showFeedback("failure","The file name is too long, it can be up to 175 characters."),!1):$(".document-input").val()==""&&n==!1?($(".doc-type-error .document-error-message").html(Please_Choose_File),$(".doc-type-error").fadeIn(),setTimeout(function(){$(".doc-type-error").fadeOut()},3e3),!1):$("#txtDocumentDate").val()==""&&i.DocumentDate==!0?($(".doc-type-error .document-error-message").html(Please_Enter_Date),$(".doc-type-error").fadeIn(),setTimeout(function(){$(".doc-type-error").fadeOut()},3e3),!1):$("#txtDocumentVersion").val()==""&&i.DocumentVersion==!0?($(".doc-type-error .document-error-message").html(Please_Enter_Version),$(".doc-type-error").fadeIn(),setTimeout(function(){$(".doc-type-error").fadeOut()},3e3),!1):(t=$("#txtDocumentDate").val().length,t>10&&$("#DateFormat").val().indexOf("M")==-1)?(showFeedback("failure","Please check if the date is correct."),!1):t>11&&$("#DateFormat").val().indexOf("M")>-1?(showFeedback("failure","Please check if the date is correct."),!1):(r=isValidDate($("#DateFormat").val()),r?!0:(showFeedback("failure","Please check if the date is correct."),!1))}function isValidDate(n){var t=!0;try{jQuery.datepicker.parseDate(n,jQuery("#txtDocumentDate").val(),null)}catch(i){t=!1}return t}function deleteDocument(n,t){var i=$(n).closest(".document-container").find(".document-hiddenInput"),r=$(n).closest(".row"),u=i.attr("id"),f=r.attr("data-userpanelid"),e=r.attr("data-instance"),o={DocumentId:t,UserProjectFormId:userProjectFormId,UserPanelId:f,ElementIdString:u,Instance:e};return $.post("/Document/DeleteDocument/",o,function(){var r=$(n).parents(".document-table-container"),t;$(n).parents("tr").remove();t=[];$(r).find("table > tbody > tr").length>0?($(r).find("table > tbody > tr").each(function(){var n=$(this).attr("data-id"),i=parseInt(n);t.push(i)}),i.val(JSON.stringify(t))):i.val("");$(".document-table-container table tbody:not(:has(:visible))").parent("table").hide();enableOrDisableUploadDocument(i.parents(".panel"));refreshAllDocumentsTable();setDataHasChanged(!0);saveForm(!1,"",!1,!1)}).fail(function(){showFeedback("failure","Unexpected error with document, contact system administrator")}),!1}function getUserDocuments(){var n="/Document/UploadedDocuments/?userProjectFormId="+userProjectFormId;$.post(n,function(n){createUploadedDocumentsUI(n)})}function getDocumentType(n){$.ajax({type:"POST",url:"/Document/GetDocumentType/",data:{id:n,userProjectFormId:$("#UserProjectFormId").val()},success:function(n){$(".txtDocumentName").html(n.Title)},error:function(){showFeedback("failure",Unexpected_Error);hidePopupOverlay()}})}function createUploadedDocumentsUI(n){var t=$("#documents-root");$.each(n,function(n,i){if(i!=null){var r="<tr class='documentRow oldDocument'><td>"+i.DocumentTypeTitle+"<\/td><td>"+i.FileName+"<\/td><td>"+i.CreatedAtShorString+"<\/td><td>"+bytesToSize(i.DocumentLength)+"<\/td><td><button type='button' class='btn btn-secondary' onclick='formModule.viewDocument("+i.Id+"); return false;'>'"+Download+"'<\/button><\/td><td><button type='button' class='btn btn-danger' onclick='deleteDocument(this, "+i.Id+")'>'"+Delete+"'<\/button><\/td><\/tr>";$(t).append(r)}})}function displayNewUploadedDocument(n,t){var i=$(t).siblings(".document-table-container").find("table"),r;$(i).find("tbody").empty();$.each(n,function(n,t){if(t!=null){console.log(t);var r='<tr class="documentRow newDocument" data-id="'+t.Id+'" style="display:none;"><td>'+t.DocumentTypeTitle+'<\/td><td class="word-break">'+t.FileName+'<\/td><td class="word-break">'+t.OriginalFileName+"<\/td><td>"+t.DocumentDateShortString+"<\/td><td>"+t.Version+"<\/td><td>"+bytesToSize(t.DocumentLength)+'<\/td><td class="hideOnPrint"><button type="button" class="btn btn-secondary" onclick="formModule.viewDocument('+t.Id+'); return false;">'+Download+'<\/button><\/td><td class="hideOnPrint"><button type="button" class="btn btn-danger" onclick="deleteDocument(this, '+t.Id+')">'+Delete+"<\/button><\/td><\/tr>";$(i).find("tbody").append(r);$(".newDocument").fadeIn()}});$(i).fadeIn();r=[];$(i).find("tbody > tr").each(function(){var n=parseInt($(this).attr("data-id"));r.push(n)});$(t).val(JSON.stringify(r));enableOrDisableUploadDocument($(t).parents(".panel"));setDataHasChanged(!0);saveForm(!1,"",!1,!1)}function bytesToSize(n){var i=["Bytes","KB","MB","GB","TB"],t;return n==0?"n/a":(t=parseInt(Math.floor(Math.log(n)/Math.log(1024))),t==0)?n+" "+i[t]:(n/Math.pow(1024,t)).toFixed(1)+" "+i[t]}function ConvertDateToLocal(n){var t=new Date(parseInt(n.substr(6)));return t.format("shortDateAndTime")}function showPopupOverlay(n){$(".popup-overlay-pane > .submit-message-1").text(Please_wait_while_submit);$(".popup-overlay-pane").css("position","absolute");var t=0;$(n).find("> div:not(.popup-overlay-pane)").each(function(){t+=$(this).outerHeight()});t+=20;t<310&&(t=310);$(".popup-overlay-pane").css("height",t);$(".popup-overlay-pane").fadeTo("fast",.7,null);$(".popup-overlay-pane").css("border-radius","6px");setTimeout(function(){$(".popup-overlay-pane > .submit-message-1").text(This_is_taking_longer_than_expected)},15e3)}function setDataHasChanged(n){dataHasChanged=n;showHideViewAsTableButton()}function showHideViewAsTableButton(){dataHasChanged?($(".viewastable .btn-viewAsTable").each(function(){var n=$(this).closest(".viewastable").attr("data-panelastableid");viewAsForm(n)}),$(".btn-viewastable").attr("onclick",""),$(".btn-viewastable").addClass("disabled")):($(".btn-viewastable").attr("onclick","viewAsTable(this)"),$(".btn-viewastable").removeClass("disabled"))}function hidePopupOverlay(){$(".popup-overlay-pane").hide()}function setDocumentsOverlay(n){var t,i;resetUpload();$("#documents-overlay").modal("show");t=$(n).attr("data-documenttypeid");$("#txtDocumentTypeId").val(t);var r=$(n).siblings("input")[0],u=$(r).attr("Id"),f=$(r).val();$("#txtDocumentInputElementId").val(u);i=$(n).closest(".row");currentQuestionId=i.attr("data-id");currentQuestionVersion=i.attr("data-version");getDocumentType(t);$("#txtDocumentId").val(f);$("#documents-overlay").on("hidden.bs.modal",function(){$(n).focus()})}function applyFormAccessRestrictions(){var t=$("#isLockedByApplicant").val(),i=$("#isLockedByReviewer").val(),n=jQuery.parseJSON($("#accessLevel").val());t=="true"||i=="true"||n.CanRead&&n.CanWrite==!1||n.CanShare&&n.CanWrite==!1?lockForm(t,i):releaseForm()}function lockForm(n,t){var i=jQuery.parseJSON($("#accessLevel").val()),r=$("#locked-bar");$("#page-form :input[data-elementtypeid]").attr("disabled","disabled");$(".document-table-container .btn-danger").attr({disabled:"disabled",onclick:""});n=="true"&&($(".btn-forms-document").hide(),r.show().find("span").text("This form has been locked through signatures/requests"),$(".add-new:not(.add-new-signature), .remove-new:not(.remove-repeated-signature)").hide(),$(".page-contact").hide());t=="true"&&($(".btn-forms-document").hide(),$(".request-button, .sign-button").hide(),$(".add-new, .remove-new").hide(),r.show().find("span").text("This form has been locked for review"),$(".page-contact").hide());i.CanSign&&($(".add-new").hide(),$(".page-contact").hide());(i.CanRead&&i.CanWrite==!1||i.CanShare&&i.CanWrite==!1)&&($("#page-form :input[data-elementtypeid]").attr("disabled","disabled"),$(".document-table-container .btn-danger").attr({disabled:"disabled",onclick:""}),$(".add-new").hide(),$(".btn-forms-document").hide(),$(".request-button, .sign-button").hide(),$(".page-contact").hide(),accessProjectLevel=="4"?r.show().find("span").text("This form has been locked by a pending project transfer."):r.show().find("span").text("Read access only."));$(".btn-viewastable").attr("disabled",!1)}function releaseForm(){var t=$("#ulActions"),i=jQuery.parseJSON($("#accessLevel").val()),n=$("#locked-bar");n.hide();$("#page-form :input[data-elementtypeid]:not(.disable-default)").removeAttr("disabled");$(".document-table-container .btn-danger").each(function(n,t){var i=$(t),r=i.parents("tr.documentRow").attr("data-id");i.removeAttr("disabled");i.attr({onclick:"deleteDocument(this,"+r+")"})});$(".btn-forms-document").each(function(n,t){var i=$(t),r=i.parents(".document-container"),u=i.parents('.panel[data-isdocument="True"]'),f=r.find(".document-table-container tbody tr"),e=u.attr("data-maxinstancecount")>1;e==!1?f.length==0&&i.show().removeAttr("disabled"):i.show().removeAttr("disabled")});$(".page-contact").show();$(".request-button, .sign-button").show()}function transferAcceptOverlay(){$("#transfer-acceptOverlay").modal("show")}function transferRejectOverlay(){$("#transfer-rejectOverlay").modal("show")}function transferAccept(){var t=$("#btn_accept"),n;t.prop("disabled",!0);n=$("#transfer-acceptOverlay .popup-overlay-pane");n.show();$.ajax({type:"POST",url:"/Transfers/AcceptTransfer/",data:{userProjectId:userProjectId},success:function(i){i=="Success"?($("#transfer-acceptOverlay").modal("hide"),showFeedback("success","Transfer accepted successfully").done(function(){window.location="/ActivityForm/Index"})):showFeedback("failure","Unable to accept transfer form");t.prop("disabled",!1);n.hide()},error:function(){showFeedback("failure","Unable to accept transfer, please contact your system administrator");t.prop("disabled",!1);n.hide()}})}function transferReject(){$.ajax({type:"POST",url:"/Transfers/RejectTransfer/",data:{userProjectId:userProjectId},success:function(n){n=="Success"?($("#transfer-rejectOverlay").modal("hide"),showFeedback("success","Transfer Rejected successfully").done(function(){window.location="/ActivityForm/Index"})):showFeedback("failure","Unable to reject transfer")},error:function(){showFeedback("failure","Unable to reject transfer, please contact your system administrator")}})}function showTransfersList(){$("#transfers-list-overlay").modal("show")}function getProjectTransferRequests(){return $.ajax({type:"GET",url:"/Transfers/GetProjectTransferRequests/",data:{userProjectId:userProjectId,__RequestVerificationToken:""},async:!1,success:function(n){if(n!=null){var t=$("#transfers-list-overlay #transfers-requests-container #transfers-requests-table-container");t.html(n);t.show();t.siblings(".alert").hide();t.find("#transfer-requests-table tbody tr").length==0&&(t.siblings(".alert").show(),t.hide())}}})}function cancelProjectTransferRequest(n){var t=$(n).parents("tr").attr("data-id");return $.ajax({type:"POST",url:"/Transfers/CancelTransfer/",data:{TransferRequestId:t,userProjectId:userProjectId},success:function(n){n=="Success"?showFeedback("success","Transfer cancel successfully").done(function(){getProjectTransferRequests()}):showFeedback("failure","Unable to cancel transfer")},error:function(){showFeedback("failure","Unable to cancel transfer, please contact your system administrator")}}),!1}function getFormActions(){return $.ajax({type:"GET",url:"/Project/GetFormActions/",data:{userProjectFormId:userProjectFormId,pageId:$("#PageId").val(),__RequestVerificationToken:"",trackChangesMode:trackChangesMode},async:!0,success:function(n){var t=$("#ulActions");t.find("li").remove();t.html(n);addExtraEmptyLinks(t);NextActionAdd();PreviousActionAdd();NavigateActionAdd();SwipeBindingForTablets()}})}function getFormIndexActions(){return $.ajax({type:"GET",url:"/Project/GetFormIndexActions/",data:{userProjectFormId:userProjectFormId,__RequestVerificationToken:""},success:function(n){var t=$("#ulActions");t.find("li").remove();t.html(n);addExtraEmptyLinks(t);CheckActions()}})}function getFormStatus(){return $.ajax({type:"GET",url:"/Project/GetFormStatus/",data:{userProjectFormId:userProjectFormId,__RequestVerificationToken:""},success:function(n){$(".statustable").html(n)}})}function refreshForm(){showInProgressFeedback("Refreshing Form");$.ajax({type:"POST",url:"/Project/Refresh/",data:{userProjectFormId:userProjectFormId,__RequestVerificationToken:""},success:function(){showFeedback("success","Form Refreshed");window.location.reload()}})}function refreshAllDocumentsTable(){getAllDocumentsTable(!1).then(function(n){$("#all-document-container").html(n);$("#all-document-table-title").hide();$("#all-document-table-buttons .btn-get-documents").hide()})}function getAllDocumentsTable(){var n=$("#load-overlay-pane");return $("#all-document-table tbody td").length===0&&n.show(),$.ajax({type:"POST",url:"/Project/GetFormDocumentsTable/",data:{userProjectFormId:userProjectFormId},complete:()=>{n.hide()}})}function GetReceiveNotifications(n){switch(n){case"1":return!0;case"2":return!1;default:return null}}function getCollaborators(){return $.ajax({type:"GET",url:"/Collaborators/GetFormCollaborators",data:{userProjectFormId:userProjectFormId},error:function(){showFeedback("failure","Unable to find collaborators")}})}function collaboratorListOverlay(){getCollaborators().then(function(n){$("#collaboratorOverlay").modal("show");$("#collaboratorOverlay #collaborator-list-container").html(n);$("#collaborator-list-container h3").hide();$("#collaboratorOverlay").on("hidden.bs.modal",function(){$("#share-list-tile button").focus()})})}function getFormSubmissionHistory(){return $.ajax({type:"GET",url:"/Submission/History",data:{userProjectFormId:userProjectFormId},error:function(){showFeedback("failure","Unable to find submission history")}})}function getFormHistory(){return $.ajax({type:"GET",url:"/Project/GetFormHistory",data:{userProjectFormId:userProjectFormId},error:function(){showFeedback("failure","Unable to find form history")}})}function getAnimal(){return $.ajax({type:"GET",url:"/Project/GetAnimalForm",data:{userProjectFormId:userProjectFormId},error:function(){showFeedback("failure","Unable to find form")}})}function saveSpecies(){return $.ajax({type:"POST",url:"/Project/SaveAnimalSpecies",data:$("#speciesForm").serialize(),success:function(n){n.length==0&&($("#newSpeciesModal").modal("hide"),getAnimal().then(function(n){$("#form-animal-container").html(n);$(".date-input").datepicker({dateFormat:dpickerdateformat});$(".date-input").attr("readonly","readonly");$("#form-animal-container :input").on("change",function(){animalhasChanged=!0;$("#leftBtnContainer").fadeIn();$("html").on("click",function(n){$(n.target).closest("#ReviewDataContainer").length==0&&(animalhasChanged==!0&&(animalhasChanged=!1,$("#leftBtnContainer").fadeOut(),saveAnimalDataForm(n,!1)),$("html").off("click"))})})}))},error:function(){showFeedback("failure","Unable to save the form")}})}function saveProcedure(){return $.ajax({type:"POST",url:"/Project/SaveAnimalProcedure",data:$("#procedureForm").serialize(),success:function(n){n.length==0&&($("#newProcedureModal").modal("hide"),getAnimal().then(function(n){$("#form-animal-container").html(n);$(".date-input").datepicker({dateFormat:dpickerdateformat});$(".date-input").attr("readonly","readonly");$("#form-animal-container :input").on("change",function(){animalhasChanged=!0;$("#leftBtnContainer").fadeIn();$("html").on("click",function(n){$(n.target).closest("#ReviewDataContainer").length==0&&(animalhasChanged==!0&&(animalhasChanged=!1,$("#leftBtnContainer").fadeOut(),saveAnimalDataForm(n,!1)),$("html").off("click"))})})}))},error:function(){showFeedback("failure","Unable to save the form")}})}function revokeSharedAccess(n){var t=$(n).parents("tr").attr("data-userId");return $.ajax({type:"POST",dataType:"json",data:{UserProjectFormId:userProjectFormId,UserId:t},url:"/Collaborators/ShareFormEdit",success:function(){showFeedback("success","Access revoked");collaboratorListOverlay()},error:function(){showFeedback("failure","Unable to revoke access")}})}function getFormReference(){return $.ajax({type:"POST",url:"/Project/GetFormReference",data:{userProjectFormId:userProjectFormId},success:function(n){$("#formReference").html(n)},error:function(){showFeedback("failure","Unable to locate form reference");$("#formReference").html("<div class='page-header'><h1>Unable to locate<\/h1><\/div>")}})}function SetFormTimelineActions(){$("#action-modal").on("hidden",function(){resetActionModal();$(".are-you-sure").remove();$("#action-modal .modal-footer #action").unbind()})}function GetTimelineAction(n,t){var r=$(t).children("button"),i=$("li[data-actionid='"+n+"']"),u=$(i).attr("data-submissionReviewid");$("#action-modal #actionType").val(n);$("#action-modal #submissionReviewIdInput").val(u);determineModal(i,r)}function determineModal(n,t){var r=$(n).attr("data-actionId"),u=$(n).attr("data-System"),i=$(n).attr("data-modal"),l=$(n).attr("data-recommendation"),f=$(n).attr("title"),e=$(n).attr("data-DisplayOnTimeline"),o=$(n).attr("data-showTemplate"),s=$(n).attr("data-RequireDownload"),h=$(n).attr("data-submissionReviewid"),c=$(n).attr("data-hasMandatoryNote");i=i.toString().toLowerCase();actionModal(f,r,i,u,e,s,c);o==="true"&&getDocumentContent(r,h);$("#action-modal").modal("show");$("#action-modal").on("hidden.bs.modal",function(){t.focus()})}function actionModal(n,t,i,r,u,f,e){fillActionBarModal(n,n,i,r,u,f,e)}function fillActionBarModal(n,t,i,r,u,f,e){var h=$("#action-modal > .modal-header > h3"),c=$("#action-modal .modal-body"),s=$("#action-modal .modal-footer #action"),o;$(h).html(n);$(s).html(t);$("#action-modal .modal-body .control-group").hide();$(".defaultaction").parents(".control-group").show();$("."+i).parents(".control-group").show();r=="true"&&$(".defaultActionOnly").parents(".control-group").hide();o="Timeline Notes:";e=="true"&&(o="Timeline Notes:*");$("label[for='action-notes-textarea']").text(o);$(s).click(function(){e!="true"||$.trim($("#action-notes-textarea").val())?areYouSureSetup2(i,u,f,e):showFeedback("failure",Timeline_Notes_Required)})}function CheckIfAutoSubmitIsEnabled(){var n=getAutoSubmissionStatus();n&&$("#signature-request-overlay #autosubmissionalert").show()}function showNMAProjectModal(){var r=null,t=$(document.createElement("div")),n=$(document.createElement("select")),u=$(document.createElement("label")),i;$(n).css({width:"70%",margin:"auto",display:"block","margin-top":"20px"});i=isProjectMarkedAsNMA();i!=null&&($(n).append($("<option><\/option>").val("true").html("Project is NMA")),$(n).append($("<option><\/option>").val("false").html("Project is not NMA")),$(n).attr("id","drpdown2"),$(n).val(i.toString()),$(u).html("Mark this project as NMA if it is to be reviewed under the National Mutual Acceptance scheme."),$(t).append(u),$(t).append(n),r=t,fillActionBarFormModal("NMA Project",r,Save,checkForInputValidation,markAsNMA,!0));$("#actionbar-modal").off("hidden.bs.modal");$("#actionbar-modal").on("hidden.bs.modal",function(){$("#makeProjectNMA").focus()})}function markAsNMA(){showPopupOverlay($("#actionbar-modal"));var r=$("#actionbar-modal > .modal-body select").val(),n=$("#UserProjectId").val(),t=$("#UserProjectFormId").val(),i=$("#drpdown2").val();$.ajax({url:"/Project/SetUserProjectNMAOption/",type:"POST",data:{userProjectId:n,nmaOption:i},success:function(){workareaFeedback("success","NMA Option updated");window.location="/Project/Index/"+t},error:function(){workareaFeedback("failure","Error updating NMA setting")}})}function showXmlImportModal(){$("#xml-overlay").modal("show");$("#xml-overlay").on("hidden.bs.modal",function(){$("#importXml").focus()})}function importXml(){showPopupOverlay($("#actionbar-modal"));var n=$("#UserProjectId").val(),t=$("#UserProjectFormId").val(),i=$("#drpdown2").val();$.ajax({url:"/Project/xxxxx/",type:"POST",data:{userProjectId:n,nmaOption:i},success:function(){workareaFeedback("success","NMA Option updated");window.location="/Project/Index/"+t},error:function(){workareaFeedback("failure","Error updating NMA setting")}})}function getAutoSubmissionStatus(){var n=!1,t=$("#UserProjectFormId").val();return $.ajax({url:"/Project/GetUserFormAutoSubmissionOption/",type:"GET",dataType:"json",data:{userProjectFormId:t},success:function(t){n=t},async:!1,beforeSend:function(){},error:function(){console.log("ERROR")}}),n}function areYouSureSetup2(n,t,i,r){var f=$(document.createElement("div")),s=$(document.createElement("label")),o=$(document.createElement("button")),e=$(document.createElement("button")),u=$("#action-modal");$(f).addClass("auto-margin are-you-sure");$(o).addClass("btn btn-success").html(Yes);$(e).addClass("btn btn-danger").html(No);$(s).html(Sure_Action);$(o).click(function(){$(this).attr("disabled","true");$(e).attr("disabled","true");$(this).html(Loading);implementAction(n,t,i,r)});$(e).click(function(){$(u).find(".modal-body :input").removeAttr("disabled");$(u).find(".modal-footer .main-action:input").removeAttr("disabled");$(u).find(".modal-footer").animate({height:"30px"},300);$(u).find(".are-you-sure").remove()});$(f).append(s);$(f).append(o);$(f).append(e);$(u).find(".modal-body :input").attr("disabled","true");$(u).find(".modal-footer .main-action:input").attr("disabled","true");$(u).find(".modal-footer").animate({height:"120px"},500);$(u).find(".modal-footer").append(f)}function implementAction(n,t,i){function u(n,t){var i=document.createElement("input");$(i).attr("name",n).val(t);f.push(i)}var f=$("#action-modal ."+n+", #action-modal .defaultaction"),r;$("#action-letter").is(":visible")&&(r=$("#DocumentContent").data("kendoEditor").value(),r!=null&&(r=r.replace(/\r\n|\r|\n/g," ")),u("DocumentContent",r));u("DisplayOnTimeline",t);u("__RequestVerificationToken",$("input[name='__RequestVerificationToken']").first().val());$.ajax({url:"/FormActions/"+n,type:"POST",data:f,success:function(n){n.response=="success"?(showFeedback("success","Successful"),resetActionModal(),i=="true"&&typeof n.attachmentId!="undefined"&&localStorage.setItem("attachmentId",n.attachmentId),location.reload()):n.response=="failed"?(showFeedback("failure","Failed"),enableActionModal()):resetActionModal()},error:function(){resetActionModal();showFeedback("failure","Failed")}})}function clearModalBody(n){$(n).find(".modal-body").empty();$(n).find(".modal-footer .are-you-sure").remove();$(n).find(".modal-footer").css("height","");$(n).find(":input").removeAttr("disabled");$(n).find("#action").unbind()}function resetActionModal(){var n=$("#action-modal");n.modal("hide");n.find(".modal-footer .are-you-sure").remove();n.find(".modal-footer").css("height","");n.find(":input:not(#action-letter-button):not(.alwaysSent)").each(function(t,i){i.checked=!1;$(i).removeAttr("disabled").val("");$("#import-draft").hide();$("#import-letter").hide();$("#preview-letter").hide();n.find(".modal-footer .horizontal-breaker").hide()});$("#action-modal").find(':input:not([data-actiontype="default"])').each(function(n,t){$(t).parents(".control-group").hide()});$("#action-modal").find("#action").unbind();$("#action-modal").find("#action-letter").empty();$("#action-modal").find("#action-letter").append('<textarea id="DocumentContent" name="DocumentContent" style="height: 350px"><\/textarea>');$("#action-modal #letter-container #letter-table-container").remove();$("#action-letter").css("width","100%");$("#import-letter").removeClass("active")}function enableActionModal(){$("#action-modal").find(".modal-footer .are-you-sure").remove();$("#action-modal").find(".modal-footer").css("height","");$("#action-modal").find(":input:not(#action-letter-button)").each(function(n,t){$(t).removeAttr("disabled")})}function getDocumentContent(n,t){$(".main-action").prop("disabled",!0);$.ajax({url:"/FormActions/TemplateForTimelineEntry/",dataType:"json",data:{eventTypeId:n,submissionReviewId:t},type:"POST",success:function(n){n.TemplateContent!=""&&(InitKendoEditor("#DocumentContent","standard",null,n.TemplateContent),$("#action-modal .modal-body").css("max-height","512px"),$("#action-letter").show(),$("#import-draft").show(),$("#import-letter").show(),$("#preview-letter").show(),$("#action-modal .modal-footer .horizontal-breaker").show())},complete:function(){$(".main-action").prop("disabled",!1)}})}function PreviewLetter(){var n=$("#DocumentContent").data("kendoEditor").value();n!=""&&($("#previewletter-form [name='HtmlToConvert']").val(n),$("#previewletter-form").submit())}function getDynamicLists(){var n=$(".dynamic-list-element[data-listid]");$(n).each(function(n,t){var r=$(t).attr("data-listid"),u=$(t).attr("disabled"),i=!0,f;if((typeof u!=typeof undefined||u=="disabled")&&(i=!1),r==0){f=JSON.parse($(t).attr("data-listitems"));$(t).kendoComboBox({dataTextField:"Name",dataValueField:"Value",dataSource:f,filter:"contains",suggest:!0,index:-1,enable:i,change:function(){this.value()&&this.selectedIndex==-1&&this.value("")}});return}getListJson(r).then(function(n){if(JSON.parse(n.IsSystemList)){let r=new kendo.data.DataSource({data:n.ListItems,sort:{field:"Name",dir:"asc"}});$(t).kendoComboBox({dataTextField:"Name",dataValueField:"Value",dataSource:r,filter:"contains",suggest:!0,index:-1,enable:i,change:function(){this.value()&&this.selectedIndex==-1&&this.value("")}})}else $(t).kendoComboBox({dataTextField:"Name",dataValueField:"Value",dataSource:n.ListItems,filter:"contains",suggest:!0,index:-1,enable:i,change:function(){this.value()&&this.selectedIndex==-1&&this.value("")}})})})}function fixOldDocuments(){$(".document-table-container").each(function(){var n=$(this).find("table");n.find("th").length==7&&(n.find("th:nth-child(2)").replaceWith('<th scope="col">Document Name<\/th><th scope="col">File Name<\/th>'),n.find("tr").each(function(){if($(this).find("td").length==7){console.log("EditedTd");var i=$(this).attr("data-id"),n="",t="";$.ajax({type:"GET",url:"/Page/GetDocumentName",data:{dataId:i},dataType:"json",success:function(i){n=i.FileName;t=i.OriginalFileName;$(this).find("td:nth-child(2)").replaceWith("<td>"+n+"<\/td><td>"+t+"<\/td>")},error:function(){showFeedback("failure","Unable to update document name.")}})}else{console.log("EditedTd(3)");var i=$(this).attr("data-id"),n="",t="";$.ajax({type:"GET",url:"/Page/GetDocumentName",data:{dataId:i},dataType:"json",success:function(i){n=i.FileName;t=i.OriginalFileName;$(this).find("td:nth-child(2)").replaceWith("<td>"+n+"<\/td>");$(this).find("td:nth-child(3)").replaceWith("<td>"+t+"<\/td>")},error:function(){showFeedback("failure","Unable to update document name")}})}}))})}function getListJson(n){return $.ajax({type:"GET",url:"/Lists/StandardListJson/?listId="+n+"&userProjectFormId="+userProjectFormId})}function shareFormOverlay(){function n(n){var t=$("#shareFormOverlay .collaborator-applicant-permissions");t.empty();$.each(n,function(n,i){if(i.Id!=256){var r='<div><input type="checkbox" data-id="'+i.Id+'" id="share-access-type-'+i.Id+'" aria-label="'+i.Name+'" class="checkbox access-type"><label class="checkbox" for="share-access-type-'+i.Id+'" style="line-height:24px;" style="display: inline-block;">'+i.Name+"<\/label><\/div>";$(t).append(r)}})}resetShareModal();$.ajax({type:"GET",dataType:"json",data:{userProjectFormId:userProjectFormId,permissionType:2},url:"/Collaborators/GetShareModel",error:function(){},success:function(t){t.ApplicantPermissions.length>0&&(n(t.ApplicantPermissions),$("#shareFormOverlay").modal("show"),SearchUser("#shareFormOverlay"))}});$("#shareFormOverlay").on("hidden.bs.modal",function(){$("#share-tile button").focus()})}function resetShareModal(){var t=$("#shareFormOverlay"),n=t.find(".modal-body ul");n.find("li").slice(2).remove();n.find(".collaborator-email").val("");n.find(".collaborator-type").val(2);n.find("div.alert").addClass("displayNone")}function SearchUser(n){if($(n).find(".modal-body ul").find(".collaborator-email").attr("data-enable_search_user")=="True"||$(n).find(".modal-body ul").find(".collaborator-email").attr("data-enable_search_user")=="true"){var t=$(n),i=t.find(".modal-body ul");i.find(".collaborator-email").each(function(){var n=$(this);n.typeahead({items:20,source:function(n,t){var i=[];map=[];$.getJSON("/Page/GetUsers/",{query:n.replace(/[<>]/g,"")},function(n){return $.each(n,function(n,t){map.push(t);i.push(t.Label)}),t(i)})},updater:function(t){for(var i=0;i<map.length;i++)if(map[i].Label==t){if(map[i].Unavailable==1){showFeedback("failure","This user is unavailable.");n.text("");return}$.ajax({type:"POST",url:"/Page/GetUserEmailById/",traditional:!0,data:{Id:map[i].Id},success:function(t){console.log(t);n.val(t);n.text(t)}})}}})})}}function shareRoleFormOverlay(){resetShareRoleModal();getCollaboratorRole();collaboratorRoleListOverlay();$("#shareRoleFormOverlay").modal("show");SearchUser("#shareRoleFormOverlay");$("#shareRoleFormOverlay").on("hidden.bs.modal",function(){$("#share-role-tile button").focus()})}function resetShareRoleModal(){var t=$("#shareRoleFormOverlay"),n=t.find(".modal-body ul");t.find(".modal-body div.alert").hide();n.find("li").slice(2).remove();n.find(".collaborator-email").val("");n.find(".collaborator-type").val(1);n.find("div.alert").addClass("displayNone")}function getCollaboratorRole(){function n(n){var t=$("#shareRoleFormOverlay .collaborator-applicant-roles");t.empty();t.append('<option value="" disabled selected>Please select...<\/option>');$.each(n,function(n,i){var r='<option value="'+i.ApplicantRoleId+'">'+$.trim(i.Name)+"<\/option>";$(t).append(r)})}$.ajax({type:"GET",dataType:"json",data:{userProjectFormId:userProjectFormId,permissionType:1},url:"/Collaborators/GetShareModel",error:function(){},success:function(t){t.ApplicantRoles.length>0&&n(t.ApplicantRoles)}})}function collaboratorRoleListOverlay(){getRoleCollaborators().then(function(n){$("#shareRoleFormOverlay #collaboratorRole-list-container").html(n)})}function getRoleCollaborators(){return $.ajax({type:"GET",url:"/Collaborators/GetFormRoleCollaborators",data:{userProjectFormId:userProjectFormId},error:function(){showFeedback("failure","Unable to find role collaborators")}})}function removeShareRoleForm(n){var t=$(n).parents("tr").attr("data-userId");return $.ajax({type:"POST",url:"/Collaborators/ShareFormEdit",data:{userProjectFormId:userProjectFormId,userId:t},success:function(){showFeedback("success","Access removed");collaboratorRoleListOverlay();getCollaborators().then(function(n){$("#form-collaborators-container").html(n)})},error:function(){showFeedback("failure","Unable to remove access")}})}function removeApplicantRole(n){return $.ajax({type:"POST",url:"/Collaborators/RemoveApplicantRole",data:{userProjectFormToApplicantRoleId:n},success:function(){showFeedback("success","Role removed successfully");collaboratorRoleListOverlay();getCollaborators().then(function(n){$("#form-collaborators-container").html(n)})},error:function(){showFeedback("failure","Unable to remove access")}})}function removeApplicantRoleAllPermissions(n){return $.ajax({type:"POST",url:"/Collaborators/removeApplicantRoleAllPermissions",data:{userProjectFormToApplicantRoleId:n},success:function(){showFeedback("success","Role removed successfully");collaboratorRoleListOverlay();getCollaborators().then(function(n){$("#form-collaborators-container").html(n)})},error:function(){showFeedback("failure","Unable to remove access")}})}function correspondOverlay(){var n=$("#correspondOverlay");n.find('input[name="userProjectId"]').val(userProjectId);n.find('input[name="userProjectFormId"]').val(userProjectFormId);getCorrespondenceCommittee().then(function(n){n.length>0?$("#correspondencemessage").html("This message will be delivered to members of "+n+"."):$("#correspondencemessage").html("This message will be delivered to review users.")});n.modal("show");$("#correspondOverlay .closeCorrespondence").unbind().click(function(){closeCorrespondence()});n.unbind().on("hidden",function(){n.find(".progress .bar").removeClass("bar-success").css("width","0")});$("#correspondOverlay").on("hidden.bs.modal",function(){$("#correspond-action button").focus()})}function getCorrespondenceCommittee(){return $.ajax({type:"GET",data:{userProjectFormId:userProjectFormId},url:"/Correspondence/GetCommittee"})}function sendCorrespondence(){$("#correspondence-form").find("textarea").val()!=""?($("#correspondence-form").find("#correspondence-empty-error").addClass("displayNone"),shared.ajaxDocumentUploader("correspondence-form")):$("#correspondence-form").find("#correspondence-empty-error").removeClass("displayNone")}function getCorrespondence(){return $.ajax({type:"GET",data:{userProjectFormId:userProjectFormId},url:"/Correspondence/GetCorrespondence"})}function getCorrespondenceDetail(n){return $.ajax({type:"GET",data:{correspondenceId:n},url:"/Correspondence/GetCorrespondenceDetail"})}function closeCorrespondence(){$("#correspondOverlay").modal("hide")}function getCorrespondenceMessageDetail(n){$.ajax({type:"GET",data:{correspondenceId:n},url:"/Correspondence/GetCorrespondenceMessageDetail",success:function(n){$("#correspondence-message-modal-container").html(n);$("#correspondence-message-overlay").modal("show")},error:function(){}})}function getUserProjectFormCentre(){return $.ajax({type:"GET",data:{userProjectFormId:userProjectFormId},url:"/Centre/GetUserProjectFormCentre"})}function getUserProjectFormCentreOverlay(){$.ajax({type:"GET",dataType:"json",data:{userProjectFormId:userProjectFormId},url:"/Centre/GetUserProjectFormEnabledCentresQuery",error:function(){},success:function(n){var t=$("#userProjectFormCentreOverlay #ddlCentres"),i=$("#userProjectFormCentreOverlay .centre-div"),r=$("#userProjectFormCentreOverlay .no-centre-div"),u=$("#userProjectFormCentreOverlay #save-form-centre-button");t.empty();n.length>0?($.each(n,function(){t.append(new Option(this.Name,this.CentreId))}),i.show(),u.show(),r.hide()):(i.hide(),u.hide(),r.show());$("#userProjectFormCentreOverlay").modal("show")}});$("#userProjectFormCentreOverlay").on("hidden.bs.modal",function(){$("#newCentre").focus()})}function CentreTabRedirect(n){$(".modal").modal("hide");$(".nav-tabs a[href=#centre-tab]").tab("show");window.location="/Project/Index/"+n+"#centre-tab"}function InitializeCollaborationListeners(){$("#collaborator-add-list .add-icon").click(function(){addAnotherCollaborator($(this),"patternCollaborator","collaborator-add-list")});$("#collaboratorRole-add-list .add-icon").click(function(){addAnotherCollaborator($(this),"patternCollaboratorRole","collaboratorRole-add-list")});$("#share-form-button").click(function(){prepareCollaborators("collaborator-add-list",2)});$("#share-role-form-button").click(function(){prepareCollaborators("collaboratorRole-add-list",1)})}function prepareCollaborators(n,t){var r=[],i=0;$("#"+n+" li:not(.displayNone)").each(function(n,u){var f;if($(u).find(".collaborator-email").length&&$(u).find(".collaborator-email").length){var o=$(u).find(".collaborator-email").val(),s=t,h=$(u).find(".collaborator-applicant-roles").val(),c=$(u).find('.collaborator-applicant-permissions input[type="checkbox"]:checked'),e=[];c.each(function(){var n=$(this).attr("data-id");e.push(n)});f={Index:i,Email:o,AccessLevel:s,ApplicantRoleId:h,Permissions:e};console.log(f);r.push(f);i=i+1}});checkCollaborators(r,t)}function checkCollaborators(n,t){$.ajax({type:"POST",url:"/Collaborators/CheckUsers",traditional:!0,data:{collaborators:JSON.stringify(n),UserProjectFormId:userProjectFormId},success:function(i){var r;r=t==1?$("#shareRoleFormOverlay"):$("#shareFormOverlay");r.find("ul li div.alert").hide();i.length>0?$.each(i,function(n,t){var i=r.find("ul li:nth-child("+(t.Index+2)+")").find("div.alert");i.removeClass("displayNone").show();i.find("div.errorMessage").text(t.Error);$btnInvite=i.find("input.invite-button");t.ErrorType==2&&t.Error!="User is not available"?$btnInvite.removeClass("displayNone"):$btnInvite.addClass("displayNone")}):sendCollaborators(n,t)},error:function(){showFeedback("failure","Unable to share form")}})}function addAnotherCollaborator(n,t,i){var e=$("#"+t),o=e.find(".remove-icon"),s,r,u,f,h;o.removeClass("displayNone");o.off("click").on("click",function(){removeCollaborator($(this))});s=e.find(".add-icon");s.addClass("displayNone");r=e.clone();r.removeAttr("id");r.removeClass("displayNone");r.css("display","none");r.find(".collaborator-email").val("");r.find(".collaborator-type").val(0);r.find(".collaborator-applicant-roles").val(0);r.find("div.alert").hide();u=r.find(".remove-icon");u.removeClass("displayNone");u.addClass("btn");u.attr("aria-label","Remove This Collaborator");u.off("click").on("click",function(){removeCollaborator($(this),t,i)});f=r.find(".add-icon");f.removeClass("displayNone");f.addClass("btn");f.attr("aria-label","Add Another Collaborator");f.off("click").on("click",function(){addAnotherCollaborator($(this),t,i)});h=$("#"+i);h.append(r);r.fadeIn();t=="patternCollaborator"?SearchUser("#shareFormOverlay"):SearchUser("#shareRoleFormOverlay")}function removeCollaborator(n,t,i){var r=n.parents("li"),u,f;if(r.is(":last-child")){previousListItem=r.prev();u=previousListItem.find(".add-icon");u.removeClass("displayNone");u.off("click").on("click",function(){addAnotherCollaborator($(this),t,i)});previousListItem.prev().length==0&&(f=previousListItem.find(".remove-icon"),f.addClass("displayNone"))}r.fadeOut(function(){r.remove()})}function sendCollaborators(n,t){var i=$("#load-overlay-pane");$.ajax({type:"POST",url:"/Collaborators/ShareForm",traditional:!0,beforeSend:function(){i.show()},data:{collaborators:JSON.stringify(n),UserProjectFormId:userProjectFormId},success:function(n){var r;r=t==1?$("#shareRoleFormOverlay"):$("#shareFormOverlay");n.length>0&&(showFeedback("failure","One or more requests failed"),$.each(n,function(n,t){r.find("ul li:nth-child("+(t.Index+1)+")").find("div.alert").text(t.Error).show()}));i.hide();showFeedback("success","Form shared successfully");getCollaborators().then(function(n){$("#form-collaborators-container").html(n)});t==1?(resetShareRoleModal(),$("#shareRoleFormOverlay").modal("hide")):(resetShareModal(),$("#shareFormOverlay").modal("hide"))},error:function(){showFeedback("failure","Unable to share form")}})}function shareFormEditOverlay(n){function i(n){var t=$("#shareFormEditOverlay .collaborator-share-edit-permissions");t.empty();$.each(n,function(n,i){var u="",r,f;i.Disabled&&(u='disabled="disabled"');r="";i.Selected&&(r='checked = "checked"');(i.Id!=256||i.Id==256&&i.Selected)&&(f='<div><input type="checkbox" '+r+' data-id="'+i.Id+'" id="share-edit-access-type-'+i.Id+'" class="checkbox access-type" '+u+' ><label class="checkbox" for="share-edit-access-type-'+i.Id+'" style="line-height:24px;" style="display: inline-block;">'+i.Name+"<\/label><\/div>",$(t).append(f))})}resetShareEditModal();var t=$(n).parents("tr").attr("data-userId");$.ajax({type:"GET",dataType:"json",data:{userProjectFormId:userProjectFormId,userId:t},url:"/Collaborators/GetShareEditModel",error:function(){},success:function(n){i(n.ApplicantPermissions);$("#shareFormEditOverlay").attr("data-Id",t);$("#shareFormEditOverlay").find("#shareFormEditHeader").text("Edit Permissions - "+n.EditedUserFullName);$("#shareFormEditOverlay").modal("show")}})}function areYouSureShareEditSetup(n,t){var r=$(document.createElement("div")),e=$(document.createElement("label")),f=$(document.createElement("button")),u=$(document.createElement("button")),i=$("#shareFormEditOverlay");$(r).addClass("auto-margin are-you-sure");$(f).addClass("btn btn-success").html(Yes);$(u).addClass("btn btn-danger").html(No);$(e).html("The user will be removed as collaborator from this form.");$(f).click(function(){$(this).attr("disabled","true");$(u).attr("disabled","true");$(this).html(Loading);ShareFormEditAction(n,t)});$(u).click(function(){$(i).find(".modal-body :input").removeAttr("disabled");$(i).find(".modal-footer .main-action:input").removeAttr("disabled");$(i).find(".modal-footer").animate({height:"30px"},300);$(i).find(".are-you-sure").remove()});$(r).append(e);$(r).append(f);$(r).append(u);$(i).find(".modal-body :input").attr("disabled","true");$(i).find(".modal-footer .main-action:input").attr("disabled","true");$(i).find(".modal-footer").animate({height:"120px"},500);$(i).find(".modal-footer").append(r)}function ShareFormEditAction(n,t){$.ajax({type:"POST",dataType:"json",data:{UserProjectFormId:userProjectFormId,UserId:n,Permissions:t},url:"/Collaborators/ShareFormEdit",traditional:!0,error:function(request){var jsonobj=eval("("+request.responseText+")");FeedbackError(jsonobj.errorMessage)},success:function(){showFeedback("success","User permissions were changed successfully");getCollaborators().then(function(n){$("#form-collaborators-container").html(n)});resetShareEditModal();$("#shareFormEditOverlay").modal("hide")}})}function resetShareEditModal(){var n=$("#shareFormEditOverlay");n.attr("data-Id","");n.find(".modal-footer .are-you-sure").remove();n.find(".modal-footer").css("height","");n.find("#shareFormEditHeader").text("");n.find(".modal-footer .main-action:input").removeAttr("disabled")}function CheckMandatoryFields(){var n=new MandatoryFieldsSchema;return $.ajax({url:"/Project/GetMandatoryFields",type:"GET",data:{questionId:currentQuestionId,questionVersion:currentQuestionVersion},async:!1,success:function(t){n=t},error:function(){}}),n}function showReviewerPanelCommentModal(n){n==0?($("#formReviewerCommentsPanel").attr("data-panelgroupid","0"),$("#formReviewerCommentsPanel-title").html("Overall Reviewer Panel Comments")):(t="/SubmissionReview/_ReviewOverallPanelCommentsModal",$("#formReviewerCommentsPanel").attr("data-panelgroupid",n),$("#formReviewerCommentsPanel-title").html("Reviewer Comments"));var t="/Project/_ReviewerPanelCommentsTable";$.ajax({type:"GET",url:t,data:{panelGroupId:n,submissionReviewId:submissionReviewId,userProjectFormId:userProjectFormId},success:function(n){$("#formReviewerCommentsPanel-table-container").html(n);$("#formReviewerCommentsPanel").modal("show")}});$("#formReviewerCommentsPanel").on("hidden.bs.modal",function(){$("#reviewCommentsButton_"+n+" :button").focus()})}function showQuestionCommentsModal(n){var t=$(n);$.ajax({type:"GET",url:"/Project/GetAnimalCommentsTable",data:{submissionReviewId:submissionReviewId,userProjectFormId:userProjectFormId,questionid:t.attr("data-questionid"),speciesinstance:t.attr("data-speciesinstance"),instance:t.attr("data-instance")},success:function(n){$("#formReviewerCommentsPanel-title").html("Reviewer Comments");$("#formReviewerCommentsPanel-table-container").html(n);$("#formReviewerCommentsPanel").modal("show")}})}function goToPanel(n){var t=$("#UserProjectFormId").val();$.ajax({type:"GET",url:"/Project/CheckPanelExists",data:{panelGroupId:n,userProjectFormId:t},success:function(i){console.log(i);i!=0?(window.location.href="/Project/Page/"+i+"/"+t+"#"+n,$("#formReviewerCommentsPanel").modal("hide")):showFeedback("failure","Cannot find question")},error:function(){showFeedback("failure","Error")}})}function goToPanelQuestion(n){var t=$("#UserProjectFormId").val(),i=$("#submissionVersion").val();$.ajax({type:"GET",url:"/Project/CheckPanelQuestionExists",data:{panelId:n,userProjectFormId:t,version:i},success:function(i){console.log(i);i!=0?(dataHasChanged?saveForm(!0,"/Project/Page/"+i+"/"+t+"?panelid="+n,!1,!1):window.location.href="/Project/Page/"+i+"/"+t+"?panelid="+n,$("#formReviewerCommentsPanel").modal("hide")):showFeedback("failure","Cannot find question")},error:function(){showFeedback("failure","Error")}})}function gotoAnimalPanel(n){var i=$("#UserProjectFormId").val(),t=$(n);$.ajax({type:"GET",url:"/Project/CheckQuestionExists",data:{userProjectFormId:i,questionid:t.attr("data-questionid"),speciesinstance:t.attr("data-speciesinstance"),instance:t.attr("data-instance")},success:function(n){if(console.log(n),n.length>0)return window.location.href="/Project/GoToAnimalPanelAnswer/"+i+"?quid="+n+"#animal-tab",$("#formReviewerCommentsPanel").modal("hide"),!1;showFeedback("failure","Cannot find question")},error:function(){showFeedback("failure","Error")}})}var setDatePickerLanguage={fr:()=>{var n={clearText:"Effacer",clearStatus:"",closeText:"Fermer",closeStatus:"Fermer sans modifier",prevText:"&lt;Prc",prevStatus:"Voir le mois prcdent",nextText:"Suiv&gt;",nextStatus:"Voir le mois suivant",currentText:"Courant",currentStatus:"Voir le mois courant",monthNames:["Janvier","Fvrier","Mars","Avril","Mai","Juin","Juillet","Aot","Septembre","Octobre","Novembre","Dcembre",],monthNamesShort:["janv.","fvr.","mars","avr.","mai","juin","juil.","aot","sept.","oct.","nov.","dc.",],monthStatus:"Voir un autre mois",yearStatus:"Voir un autre anne",weekHeader:"Sm",weekStatus:"",dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi",],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],dayStatus:"Utiliser DD comme premier jour de la semaine",dateStatus:"Choisir le DD, MM d",dateFormat:"dd/mm/yy",firstDay:0,initStatus:"Choisir la date",isRTL:!1};$.datepicker.regional.fr=n;$.datepicker.setDefaults(n)}},currentPagesDocumentElementsArray=[],currentPagesDocumentIds=[],currentPagesDocumentsArray=[],dependencies=[],dependencyGroups=[],pageReady=!1,dataHasChanged=!1,dependencyArray=[],panelArray=[],completedPanels,DependenciesChangedModule,locked,editLocked,editNumber,accessProjectLevel,submissionReviewId,userProjectFormId;Object.size=function(n){var t=0;for(var i in n)n.hasOwnProperty(i)&&t++;return t};const isDirty=n=>setDataHasChanged(n),formSaved=n=>{n?(showFeedback("success",Save_complete),setDataHasChanged(!1)):(showFeedback("failure","Your updates were not saved due to an error on the page"),setDataHasChanged(!0)),saveComplete()},handleMessage=n=>{switch(n.data.command){case"isDirty":isDirty(n.data.value);break;case"formSaved":formSaved(n.data.value)}};$(document).ready(function(){$("#printFormOverlay .Print").click(PrintForm);$(".numericInput").each(function(){var n=$(this);n.attr("data-numericrangeenabled")=="True"&&n.bind("keyup input",function(){checkNumericValues(n)})});window.addEventListener("message",n=>{handleMessage(n)});const n="attachmentId";ViewDocumentAttachment(localStorage.getItem(n));localStorage.setItem(n,null)});completedPanels=[];DependenciesChangedModule=function(){var n=!1,t=!1,i=function(){n=!1;t=!1},r=function(){n=!0},u=function(){t=!0},f=function(){t&&n?($("#questionalertcontainer").remove(),$("<div>",{id:"questionalertcontainer",style:"position: fixed; left: -1000px;","aria-live":"polite","aria-label":"Your answer has made new questions appear, and removed others",role:"alert"}).appendTo("body")):t?($("#questionalertcontainer").remove(),$("<div>",{id:"questionalertcontainer",style:"position: fixed; left: -1000px;","aria-live":"polite","aria-label":"Your answer has removed some questions",role:"alert"}).appendTo("body")):n&&($("#questionalertcontainer").remove(),$("<div>",{id:"questionalertcontainer",style:"position: fixed; left: -1000px;","aria-live":"polite","aria-label":"Your answer has made new questions appear",role:"alert"}).appendTo("body"))};return{reset:i,shown:r,hidden:u,speak:f}}();jQuery.fn.singleDependencyAction=function(n,t){if(t){if(!$(this).is(":visible")){DependenciesChangedModule.shown();$(this).show();var i=$(this).closest(".panel");i.show();i.attr("data-enabled",!0);$(this).attr("data-enabled",!0);$(this).find(".table-hover").length>0&&$(this).find(".table-hover").show()}}else $(this).is(":visible")&&($(this).hide(),DependenciesChangedModule.hidden(),clearPanelAnswers(this,!0,!1),$(this).attr("date-value","0"),$(this).attr("data-enabled",!1))};const scrollToItem=n=>{if(n!==""){const i=$("#scrollToPanelInstanceId").val();let t=getItemInstance(n,i);scrollAndHighlightElement(t);appendClickHandler(t,"mandatory");highlightEmptyMandatoryInputsInArrayElements(t)}},getItemInstance=(n,t)=>{let i=$("#"+n);return $("#page-form").find(`[data-id=${n}]`).each(function(){let n=$(this);n.attr("data-instance")===t&&(i=n)}),i},scrollAndHighlightElement=n=>{$("html,body").animate({scrollTop:$(n).offset().top-($(window).height()-$(n).outerHeight(!0))/2},200).promise().done(()=>{n.addClass("mandatory"),n.effect("bounce",{distance:5,times:1},"fast")})},appendClickHandler=(n,t)=>{$(n).click(function(){n.removeClass(t)})},highlightEmptyMandatoryInputsInArrayElements=n=>{$(n).find('div[data-mandatory="True"]').each(function(){let n=$(this).find(":input");if(n.val()==="")n.addClass("mandatory").on("click",function(){$(this).removeClass("mandatory")})})};locked=!1;editLocked=!1;editNumber=0;addNewFormCommentPanel=()=>{var n=$("#formCommentsPanel").attr("data-panelgroupid");showUpsertFormCommentPanelModal(0,userProjectFormId,n)};showUpsertFormCommentPanelModal=(n,t,i)=>{var r,u,f;$("#formCommentsPanel").modal("hide");r=$("#commentsPanelUpsertModal");$("#newCommentTextbox").val("");u=$("#commentsPanelUpsert-title");r.attr({"data-formPanelCommentId":n,"data-userProjectFormId":t,"data-panelGroupId":i});n>0?(f={formPanelCommentId:n,userProjectFormId:t},$.ajax({url:"/Page/GetPanelCommentById/",type:"GET",data:f,success:function(n){u.html("Edit comment");r.modal("show");$("#newCommentTextbox").val(n.Comment.replace(/<br\s*[\/]?>/gi,"\n"))}})):(u.html("Add new comment"),r.modal("show"))};upsertFormCommentPanel=()=>{var n=$("#commentsPanelUpsertModal"),t={formPanelCommentId:n.attr("data-formPanelCommentId"),userProjectFormId:n.attr("data-userProjectFormId"),panelGroupId:n.attr("data-panelGroupId"),comment:$("#newCommentTextbox").val().trim()};$.ajax({url:"/Page/UpsertPanelComment/",type:"POST",data:t,success:function(){showFeedback("success","Successfully saved.");n.modal("hide");var i=$("#formCommentsPanel-table tbody tr").length;updatePanelCount(i+1);loadPanelGroup(t.userProjectFormId,t.panelGroupId);getFormActions()},error:function(){showFeedback("failure",Fail_Add_Com);setTimeout(unlock,1e3)}})};deleteFormCommentPanel=n=>{var t=$("#formCommentsPanel-table tr[data-id="+n+"]");$.ajax({type:"POST",url:"/Page/DeletePanelComment",data:{userProjectFormId:userProjectFormId,id:n},success:function(){showFeedback("success",Comment_Deleted);$(t).fadeOut(function(){$(this).remove();var n=$("#formCommentsPanel #formCommentsPanel-table tbody tr").length;updatePanelCount(n);getFormActions();editUnlock()})},error:function(){showFeedback("failure",Fail_Delete_Comment);editUnlock()}})};$("#commentsPanelUpsertModal").on("hidden.bs.modal",function(){$("#formCommentsPanel").modal("show")});var ShowFormActions=$("#hidShowFormActions").val(),ShowFormPageActions=$("#hidShowFormPageActions").val(),ShowWorkAreaActions=$("#hidShowWorkAreaActions").val(),currentQuestionId,currentQuestionVersion,userProjectId=$("#UserProjectId").val(),userProjectFormId=$("#UserProjectFormId").val(),projectId=$("#ProjectId").val(),formId=$("#FormId").val(),pageId=$("#PageId").val(),trackChangesMode=$("#TrackChangesMode").val();pageId==undefined&&(pageId=0);accessProjectLevel=$("#accessProjectLevel").val();$("#save-form-centre-button").click(function(){var n=$("#userProjectFormCentreOverlay #ddlCentres").val();$.ajax({type:"POST",dataType:"json",data:{UserProjectFormId:userProjectFormId,CentreId:n},url:"/Centre/SaveUserProjectFormCentre",traditional:!0,error:function(){FeedbackError("Error")},success:function(){showFeedback("success","Form centre was saved successfully");getUserProjectFormCentre().then(function(n){$("#form-centre-container").html(n)});$("#userProjectFormCentreOverlay").modal("hide")}})});$("body").delegate(".collaborator-type","change",function(){var i=$(this).parents("li"),r=$(this).val(),n=i.find(".collaborator-applicant-roles"),t=i.find(".collaborator-applicant-permissions");r==1?(t.addClass("displayNone"),n.removeClass("displayNone"),n.removeAttr("disabled")):r==2?(t.removeClass("displayNone"),n.addClass("displayNone")):(t.addClass("displayNone"),n.removeClass("displayNone"),t.prop("disabled",!0),n.val(0))});$("#share-form-edit-button").click(function(){var t=$("#shareFormEditOverlay").attr("data-Id"),i=$("#shareFormEditOverlay").find('.collaborator-share-edit-permissions input[type="checkbox"]:checked'),n=[];i.each(function(){var t=$(this).attr("data-id");n.push(t)});n.length==0?areYouSureShareEditSetup(t,n):ShareFormEditAction(t,n)});$("body").delegate(".invite-button","click",function(n){n.preventDefault();var t=$(this).parents("li"),i=$(t).find(".collaborator-email").val(),r=$(this);$.ajax({type:"POST",dataType:"json",data:{UserProjectFormId:userProjectFormId,Email:i},url:"/Collaborators/InviteCollaborator",traditional:!0,error:function(request){var jsonobj=eval("("+request.responseText+")");FeedbackError(jsonobj.errorMessage)},success:function(n){n==!0?showFeedback("failure","User could not be invited as there is a beta test conflict."):showFeedback("success","User has been successfully invited.");r.addClass("displayNone")}})}),function(n){"use strict";function u(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),n(this).ajaxSubmit(i))}function f(t){var r=t.target,u=n(r),f,i,e;if(!u.is("[type=submit],[type=image]")){if(f=u.closest("[type=submit]"),f.length===0)return;r=f[0]}i=this;i.clk=r;r.type=="image"&&(t.offsetX!==undefined?(i.clk_x=t.offsetX,i.clk_y=t.offsetY):typeof n.fn.offset=="function"?(e=u.offset(),i.clk_x=t.pageX-e.left,i.clk_y=t.pageY-e.top):(i.clk_x=t.pageX-r.offsetLeft,i.clk_y=t.pageY-r.offsetTop));setTimeout(function(){i.clk=i.clk_x=i.clk_y=null},100)}function t(){if(n.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var i={},r;i.fileapi=n("<input type='file'/>").get(0).files!==undefined;i.formdata=window.FormData!==undefined;r=!!n.fn.prop;n.fn.attr2=function(){if(!r)return this.attr.apply(this,arguments);var n=this.prop.apply(this,arguments);return n&&n.jquery||typeof n=="string"?n:this.attr.apply(this,arguments)};n.fn.ajaxSubmit=function(u){function ft(t){for(var r=n.param(t).split("&"),e=r.length,f=[],u,i=0;i<e;i++)r[i]=r[i].replace(/\+/g," "),u=r[i].split("="),f.push([decodeURIComponent(u[0]),decodeURIComponent(u[1])]);return f}function et(t){for(var f,r,o,e=new FormData,i=0;i<t.length;i++)e.append(t[i].name,t[i].value);if(u.extraData)for(f=ft(u.extraData),i=0;i<f.length;i++)f[i]&&e.append(f[i][0],f[i][1]);return u.data=null,r=n.extend(!0,{},n.ajaxSettings,u,{contentType:!1,processData:!1,cache:!1,type:h||"POST"}),u.uploadProgress&&(r.xhr=function(){var n=jQuery.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){var t=0,i=n.loaded||n.position,r=n.total;n.lengthComputable&&(t=Math.ceil(i/r*100));u.uploadProgress(n,i,r,t)},!1),n}),r.data=null,o=r.beforeSend,r.beforeSend=function(n,t){t.data=e;o&&o.call(this,n,t)},n.ajax(r)}function rt(i){function ot(n){var i=null;try{n.contentWindow&&(i=n.contentWindow.document)}catch(r){t("cannot get iframe.contentWindow document: "+r)}if(i)return i;try{i=n.contentDocument?n.contentDocument:n.document}catch(r){t("cannot get iframe.contentDocument: "+r);i=n.document}return i}function st(){function s(){try{var n=ot(a).readyState;t("state = "+n);n&&n.toLowerCase()=="uninitialized"&&setTimeout(s,50)}catch(i){t("Server abort: ",i," (",i.name,")");b(tt);g&&clearTimeout(g);g=undefined}}var u=f.attr2("target"),o=f.attr2("action"),r,i,c;l.setAttribute("target",d);h||l.setAttribute("method","POST");o!=e.url&&l.setAttribute("action",e.url);e.skipEncodingOverride||h&&!/post/i.test(h)||f.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"});e.timeout&&(g=setTimeout(function(){rt=!0;b(ut)},e.timeout));r=[];try{if(e.extraData)for(i in e.extraData)e.extraData.hasOwnProperty(i)&&(n.isPlainObject(e.extraData[i])&&e.extraData[i].hasOwnProperty("name")&&e.extraData[i].hasOwnProperty("value")?r.push(n('<input type="hidden" name="'+e.extraData[i].name+'">').val(e.extraData[i].value).appendTo(l)[0]):r.push(n('<input type="hidden" name="'+i+'">').val(e.extraData[i]).appendTo(l)[0]));e.iframeTarget||(v.appendTo("body"),a.attachEvent?a.attachEvent("onload",b):a.addEventListener("load",b,!1));setTimeout(s,15);try{l.submit()}catch(y){c=document.createElement("form").submit;c.apply(l)}}finally{l.setAttribute("action",o);u?l.setAttribute("target",u):f.removeAttr("target");n(r).remove()}}function b(i){var r,u,w,f,k,d,h,c,l;if(!o.aborted&&!lt){if(s=ot(a),s||(t("cannot access response document"),i=tt),i===ut&&o){o.abort("timeout");y.reject(o,"timeout");return}if(i==tt&&o){o.abort("server abort");y.reject(o,"error","server abort");return}if(s&&s.location.href!=e.iframeSrc||rt){a.detachEvent?a.detachEvent("onload",b):a.removeEventListener("load",b,!1);r="success";try{if(rt)throw"timeout";if(w=e.dataType=="xml"||s.XMLDocument||n.isXMLDoc(s),t("isXml="+w),!w&&window.opera&&(s.body===null||!s.body.innerHTML)&&--ct){t("requeing onLoad callback, DOM not available");setTimeout(b,250);return}f=s.body?s.body:s.documentElement;o.responseText=f?f.innerHTML:null;o.responseXML=s.XMLDocument?s.XMLDocument:s;w&&(e.dataType="xml");o.getResponseHeader=function(n){var t={"content-type":e.dataType};return t[n]};f&&(o.status=Number(f.getAttribute("status"))||o.status,o.statusText=f.getAttribute("statusText")||o.statusText);k=(e.dataType||"").toLowerCase();d=/(json|script|text)/.test(k);d||e.textarea?(h=s.getElementsByTagName("textarea")[0],h?(o.responseText=h.value,o.status=Number(h.getAttribute("status"))||o.status,o.statusText=h.getAttribute("statusText")||o.statusText):d&&(c=s.getElementsByTagName("pre")[0],l=s.getElementsByTagName("body")[0],c?o.responseText=c.textContent?c.textContent:c.innerText:l&&(o.responseText=l.textContent?l.textContent:l.innerText))):k=="xml"&&!o.responseXML&&o.responseText&&(o.responseXML=at(o.responseText));try{ht=yt(o,k,e)}catch(nt){r="parsererror";o.error=u=nt||r}}catch(nt){t("error caught: ",nt);r="error";o.error=u=nt||r}o.aborted&&(t("upload aborted"),r=null);o.status&&(r=o.status>=200&&o.status<300||o.status===304?"success":"error");r==="success"?(e.success&&e.success.call(e.context,ht,"success",o),y.resolve(o.responseText,"success",o),p&&n.event.trigger("ajaxSuccess",[o,e])):r&&(u===undefined&&(u=o.statusText),e.error&&e.error.call(e.context,o,r,u),y.reject(o,"error",u),p&&n.event.trigger("ajaxError",[o,e,u]));p&&n.event.trigger("ajaxComplete",[o,e]);p&&!--n.active&&n.event.trigger("ajaxStop");e.complete&&e.complete.call(e.context,o,r);lt=!0;e.timeout&&clearTimeout(g);setTimeout(function(){e.iframeTarget||v.remove();o.responseXML=null},100)}}}var l=f[0],it,nt,e,p,d,v,a,o,k,w,rt,g,y=n.Deferred(),ut,tt,ft,et,ht,s,ct,lt;if(i)for(nt=0;nt<c.length;nt++)it=n(c[nt]),r?it.prop("disabled",!1):it.removeAttr("disabled");if(e=n.extend(!0,{},n.ajaxSettings,u),e.context=e.context||e,d="jqFormIO"+(new Date).getTime(),e.iframeTarget?(v=n(e.iframeTarget),w=v.attr2("name"),w?d=w:v.attr2("name",d)):(v=n('<iframe name="'+d+'" src="'+e.iframeSrc+'" />'),v.css({position:"absolute",top:"-1000px",left:"-1000px"})),a=v[0],o={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(i){var r=i==="timeout"?"timeout":"aborted";t("aborting upload... "+r);this.aborted=1;try{a.contentWindow.document.execCommand&&a.contentWindow.document.execCommand("Stop")}catch(u){}v.attr("src",e.iframeSrc);o.error=r;e.error&&e.error.call(e.context,o,r,i);p&&n.event.trigger("ajaxError",[o,e,r]);e.complete&&e.complete.call(e.context,o,r)}},p=e.global,p&&0==n.active++&&n.event.trigger("ajaxStart"),p&&n.event.trigger("ajaxSend",[o,e]),e.beforeSend&&e.beforeSend.call(e.context,o,e)===!1)return e.global&&n.active--,y.reject(),y;if(o.aborted)return y.reject(),y;k=l.clk;k&&(w=k.name,w&&!k.disabled&&(e.extraData=e.extraData||{},e.extraData[w]=k.value,k.type=="image"&&(e.extraData[w+".x"]=l.clk_x,e.extraData[w+".y"]=l.clk_y)));ut=1;tt=2;ft=n("meta[name=csrf-token]").attr("content");et=n("meta[name=csrf-param]").attr("content");et&&ft&&(e.extraData=e.extraData||{},e.extraData[et]=ft);e.forceSync?st():setTimeout(st,10);ct=50;var at=n.parseXML||function(n,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n)):t=(new DOMParser).parseFromString(n,"text/xml"),t&&t.documentElement&&t.documentElement.nodeName!="parsererror"?t:null},vt=n.parseJSON||function(s){return window.eval("("+s+")")},yt=function(t,i,r){var f=t.getResponseHeader("content-type")||"",e=i==="xml"||!i&&f.indexOf("xml")>=0,u=e?t.responseXML:t.responseText;return e&&u.documentElement.nodeName==="parsererror"&&n.error&&n.error("parsererror"),r&&r.dataFilter&&(u=r.dataFilter(u,i)),typeof u=="string"&&(i==="json"||!i&&f.indexOf("json")>=0?u=vt(u):(i==="script"||!i&&f.indexOf("javascript")>=0)&&n.globalEval(u)),u};return y}var h,b,e,f,a,v,c,y,o,l,s,d,it,p,w;if(!this.length)return t("ajaxSubmit: skipping submit process - no element selected"),this;if(f=this,typeof u=="function"&&(u={success:u}),h=this.attr2("method"),b=this.attr2("action"),e=typeof b=="string"?n.trim(b):"",e=e||window.location.href||"",e&&(e=(e.match(/^([^#]+)/)||[])[1]),u=n.extend(!0,{url:e,success:n.ajaxSettings.success,type:h||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},u),a={},this.trigger("form-pre-serialize",[this,u,a]),a.veto)return t("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(u.beforeSerialize&&u.beforeSerialize(this,u)===!1)return t("ajaxSubmit: submit aborted via beforeSerialize callback"),this;if(v=u.traditional,v===undefined&&(v=n.ajaxSettings.traditional),c=[],o=this.formToArray(u.semantic,c),u.data&&(u.extraData=u.data,y=n.param(u.data,v)),u.beforeSubmit&&u.beforeSubmit(o,this,u)===!1)return t("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[o,this,u,a]),a.veto)return t("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;l=n.param(o,v);y&&(l=l?l+"&"+y:y);u.type.toUpperCase()=="GET"?(u.url+=(u.url.indexOf("?")>=0?"&":"?")+l,u.data=null):u.data=l;s=[];u.resetForm&&s.push(function(){f.resetForm()});u.clearForm&&s.push(function(){f.clearForm(u.includeHidden)});!u.dataType&&u.target?(d=u.success||function(){},s.push(function(t){var i=u.replaceTarget?"replaceWith":"html";n(u.target)[i](t).each(d,arguments)})):u.success&&s.push(u.success);u.success=function(n,t,i){for(var e=u.context||this,r=0,o=s.length;r<o;r++)s[r].apply(e,[n,t,i||f,f])};var ut=n('input[type=file]:enabled[value!=""]',this),g=ut.length>0,nt="multipart/form-data",tt=f.attr("enctype")==nt||f.attr("encoding")==nt,k=i.fileapi&&i.formdata;for(t("fileAPI :"+k),it=(g||tt)&&!k,u.iframe!==!1&&(u.iframe||it)?u.closeKeepAlive?n.get(u.closeKeepAlive,function(){p=rt(o)}):p=rt(o):p=(g||tt)&&k?et(o):n.ajax(u),f.removeData("jqxhr").data("jqxhr",p),w=0;w<c.length;w++)c[w]=null;return this.trigger("form-submit-notify",[this,u]),this};n.fn.ajaxForm=function(i){if(i=i||{},i.delegation=i.delegation&&n.isFunction(n.fn.on),!i.delegation&&this.length===0){var r={s:this.selector,c:this.context};return!n.isReady&&r.s?(t("DOM not ready, queuing ajaxForm"),n(function(){n(r.s,r.c).ajaxForm(i)}),this):(t("terminating; zero elements found by selector"+(n.isReady?"":" (DOM not ready)")),this)}if(i.delegation){n(document).off("submit.form-plugin",this.selector,u).off("click.form-plugin",this.selector,f).on("submit.form-plugin",this.selector,i,u).on("click.form-plugin",this.selector,i,f);return this}return this.ajaxFormUnbind().bind("submit.form-plugin",i,u).bind("click.form-plugin",i,f)};n.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};n.fn.formToArray=function(t,r){var o=[],e,c,l,s,f,h,u,p,w,a,y,v;if(this.length===0||(e=this[0],c=t?e.getElementsByTagName("*"):e.elements,!c))return o;for(l=0,p=c.length;l<p;l++)if(u=c[l],f=u.name,f&&!u.disabled){if(t&&e.clk&&u.type=="image"){e.clk==u&&(o.push({name:f,value:n(u).val(),type:u.type}),o.push({name:f+".x",value:e.clk_x},{name:f+".y",value:e.clk_y}));continue}if(h=n.fieldValue(u,!0),h&&h.constructor==Array)for(r&&r.push(u),s=0,w=h.length;s<w;s++)o.push({name:f,value:h[s]});else if(i.fileapi&&u.type=="file")if(r&&r.push(u),a=u.files,a.length)for(s=0;s<a.length;s++)o.push({name:f,value:a[s],type:u.type});else o.push({name:f,value:"",type:u.type});else h!==null&&typeof h!="undefined"&&(r&&r.push(u),o.push({name:f,value:h,type:u.type,required:u.required}))}return!t&&e.clk&&(y=n(e.clk),v=y[0],f=v.name,f&&!v.disabled&&v.type=="image"&&(o.push({name:f,value:y.val()}),o.push({name:f+".x",value:e.clk_x},{name:f+".y",value:e.clk_y}))),o};n.fn.formSerialize=function(t){return n.param(this.formToArray(t))};n.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var f=this.name,r,u,e;if(f)if(r=n.fieldValue(this,t),r&&r.constructor==Array)for(u=0,e=r.length;u<e;u++)i.push({name:f,value:r[u]});else r!==null&&typeof r!="undefined"&&i.push({name:this.name,value:r})}),n.param(i)};n.fn.fieldValue=function(t){for(var f,i,r=[],u=0,e=this.length;u<e;u++)(f=this[u],i=n.fieldValue(f,t),i!==null&&typeof i!="undefined"&&(i.constructor!=Array||i.length))&&(i.constructor==Array?n.merge(r,i):r.push(i));return r};n.fieldValue=function(t,i){var a=t.name,u=t.type,h=t.tagName.toLowerCase(),e,o,r,f;if(i===undefined&&(i=!0),i&&(!a||t.disabled||u=="reset"||u=="button"||(u=="checkbox"||u=="radio")&&!t.checked||(u=="submit"||u=="image")&&t.form&&t.form.clk!=t||h=="select"&&t.selectedIndex==-1))return null;if(h=="select"){if(e=t.selectedIndex,e<0)return null;var c=[],l=t.options,s=u=="select-one",v=s?e+1:l.length;for(o=s?e:0;o<v;o++)if(r=l[o],r.selected){if(f=r.value,f||(f=r.attributes&&r.attributes.value&&!r.attributes.value.specified?r.text:r.value),s)return f;c.push(f)}return c}return n(t).val()};n.fn.clearForm=function(t){return this.each(function(){n("input,select,textarea",this).clearFields(t)})};n.fn.clearFields=n.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,u=this.tagName.toLowerCase();i.test(r)||u=="textarea"?this.value="":r=="checkbox"||r=="radio"?this.checked=!1:u=="select"?this.selectedIndex=-1:r=="file"?/MSIE/.test(navigator.userAgent)?n(this).replaceWith(n(this).clone(!0)):n(this).val(""):t&&(t===!0&&/hidden/.test(r)||typeof t=="string"&&n(this).is(t))&&(this.value="")})};n.fn.resetForm=function(){return this.each(function(){typeof this.reset!="function"&&(typeof this.reset!="object"||this.reset.nodeType)||this.reset()})};n.fn.enable=function(n){return n===undefined&&(n=!0),this.each(function(){this.disabled=!n})};n.fn.selected=function(t){return t===undefined&&(t=!0),this.each(function(){var r=this.type,i;r=="checkbox"||r=="radio"?this.checked=t:this.tagName.toLowerCase()=="option"&&(i=n(this).parent("select"),t&&i[0]&&i[0].type=="select-one"&&i.find("option").selected(!1),this.selected=t)})};n.fn.ajaxSubmit.debug=!1}(jQuery);submissionReviewId=$("#SubmissionReviewId").val();userProjectFormId=$("#UserProjectFormId").val()